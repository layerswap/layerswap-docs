<html lang="en" class="scroll-smooth antialiased scroll-pt-[32px]">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Performance Optimization -->
    <link rel="preconnect" href="https://api.layerswap.io">
    <link rel="dns-prefetch" href="https://api.layerswap.io">
    <link rel="preconnect" href="https://cdn.layerswap.io">
    <link rel="dns-prefetch" href="https://cdn.layerswap.io">

    <!-- Primary Meta Tags -->
    <title>Onboard Users from Any Chain with Single API - Layerswap Deposit API Tutorial</title>
    <meta name="title" content="Onboard Users from Any Chain with Single API - Layerswap Deposit API Tutorial">
    <meta name="description" content="Onboard users from any blockchain with a single API. Accept deposits from 70+ chains with one integration. Simplify crypto onboarding for wallets & dApps. Real-time processing, $5B+ volume.">
    <meta name="keywords" content="crypto user onboarding, single api integration, multi-chain onboarding, cross-chain deposits, blockchain onboarding api, user acquisition api, crypto deposit api, one api all chains, layerswap api, wallet onboarding, dapp onboarding, universal deposit api, crypto onramp api, web3 onboarding, defi integration, single deposit address, any chain deposits, instant onboarding, blockchain integration api, crypto payment api, multi-chain api, cross-chain api, deposit aggregator">
    <meta name="author" content="Layerswap Labs, Inc.">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="category" content="Technology, Blockchain, API Documentation, Developer Tools">
    <!-- Additional SEO Meta Tags -->
    <meta name="application-name" content="Layerswap Deposit API">
    <meta name="rating" content="general">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta http-equiv="content-language" content="en">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">

    <!-- Geo Tags -->
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="Global">
    <meta name="geo.position" content="0;0">
    <meta name="ICBM" content="0, 0">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://api.layerswap.io/tutorial">
    <meta property="og:title" content="Onboard Users from Any Chain with Single API | Layerswap">
    <meta property="og:description" content="Onboard users from any blockchain with one API. Accept deposits from 70+ chains. Interactive tutorial with live examples. Start integrating in minutes.">
    <meta property="og:image" content="https://cdn.layerswap.io/og-image-api-tutorial.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Layerswap API">
    <meta property="og:locale" content="en_US">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://api.layerswap.io/tutorial">
    <meta name="twitter:title" content="Onboard Users from Any Chain with Single API">
    <meta name="twitter:description" content="Simplify crypto user onboarding. Accept deposits from 70+ blockchains with one API integration. Interactive tutorial included.">
    <meta name="twitter:image" content="https://cdn.layerswap.io/og-image-api-tutorial.png">
    <meta name="twitter:site" content="@layerswap">
    <meta name="twitter:creator" content="@layerswap">

    <link rel="icon" type="image/svg+xml" href="logo.svg">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="canonical" href="https://api.layerswap.io/tutorial">

    <!-- Tailwind Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              brand: '#CC2D5D',
              'brand-dark': '#E53E7B',
              surface: {
                DEFAULT: '#FFFFFF',
                soft: '#F9FAFB',
                highlight: '#F1F5F9',
                dark: '#0D0A0D',
                'dark-soft': '#131015',
                'dark-muted': '#1B171D'
              },
              ink: {
                DEFAULT: '#1A1F2E',
                soft: '#6B7588',
                muted: '#A3ADC2',
                invert: '#F4F5F7',
                'invert-soft': '#C9CDD4'
              }
            },
            fontFamily: {
              sans: ['Inter', 'Inter var', 'system-ui', 'sans-serif']
            },
            boxShadow: {
              'mint-card': '0 26px 60px -45px rgba(2, 12, 27, 0.55)'
            },
            borderRadius: {
              '2xl': '18px'
            }
          }
        }
      }
    </script>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechArticle",
        "headline": "Onboard Users from Any Chain with Single API",
        "description": "Interactive tutorial for integrating Layerswap Deposit API to accept deposits from 70+ blockchain networks",
        "author": {
            "@type": "Organization",
            "name": "Layerswap Labs, Inc.",
            "url": "https://layerswap.io"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Layerswap",
            "logo": {
                "@type": "ImageObject",
                "url": "https://layerswap.io/logo.svg"
            }
        },
        "datePublished": "2024-01-01",
        "dateModified": "2025-11-02",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://api.layerswap.io/tutorial"
        },
        "image": "https://cdn.layerswap.io/og-image-api-tutorial.png",
        "articleSection": "API Documentation",
        "keywords": "crypto api, blockchain integration, cross-chain deposits, multi-chain api",
        "inLanguage": "en",
        "proficiencyLevel": "Intermediate",
        "dependencies": "RESTful API",
        "programmingLanguage": "JavaScript",
        "teaches": {
            "@type": "Course",
            "name": "Layerswap Deposit API Integration",
            "description": "Learn to integrate cross-chain deposit functionality",
            "provider": {
                "@type": "Organization",
                "name": "Layerswap"
            }
        }
    }
    </script>

    <style>
        /* === RESET === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* === SMOOTH SCROLLING === */
        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-padding-top: 32px;
        }

        /* === FOCUS STYLES FOR ACCESSIBILITY === */
        *:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        /* === THEME VARIABLES === */
        :root {
            /* Light Mode Colors */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9FAFB;
            --bg-tertiary: #EEF2F6;
            --bg-highlight: #F1F5F9;
            --bg-accent: #FFE8F0;

            --text-primary: #1A1F2E;
            --text-secondary: #6B7588;
            --text-tertiary: #A3ADC2;

            --border-primary: #D8DCE6;
            --border-secondary: #E8EBF0;
            --border-accent: #8B95AA;
            --border-subtle: rgba(15, 23, 42, 0.08);

            --accent-primary: #CC2D5D;
            --accent-hover: #B22651;

            --panel-bg: rgba(255, 255, 255, 0.96);
            --panel-border: rgba(148, 163, 184, 0.24);
            --panel-header-bg: rgba(148, 163, 184, 0.12);
            --panel-response-header-bg: rgba(148, 163, 184, 0.12);
            --panel-info-bg: rgba(248, 250, 252, 0.9);
            --code-surface: rgba(248, 250, 252, 0.95);

            --success-bg: #E8F7EE;
            --success-border: #4CAF80;
            --success-text: #1E7A45;

            --error-bg: #FDEEF0;
            --error-border: #E85C6E;
            --error-text: #C1344A;

            --info-bg: #EBF4FF;
            --info-border: #6BA3E8;
            --info-text: #2563B5;

            --warning-bg: #FFF8E6;
            --warning-border: #FFB74D;
            --warning-text: #E65100;

            --code-bg: #F8FAFC;
            --code-text: #0F172A;
            --shadow: rgba(15, 23, 42, 0.06);

            /* Spacing Scale */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 24px;
            --space-2xl: 32px;

            /* JSON Syntax Colors */
            --json-key: #9cdcfe;
            --json-string: #ce9178;
            --json-number: #b5cea8;
            --json-boolean: #569cd6;
            --json-null: #569cd6;
            --json-bracket: #d4d4d4;
        }

        [data-theme="dark"] {
            /* Dark Mode Colors matching Mintlify Aspen */
            --bg-primary: #0D0A0D;
            --bg-secondary: #131015;
            --bg-tertiary: #1B171D;
            --bg-highlight: rgba(204, 45, 93, 0.08);
            --bg-accent: rgba(204, 45, 93, 0.12);

            --text-primary: #F4F5F7;
            --text-secondary: #C9CDD4;
            --text-tertiary: #8D94A5;

            --border-primary: rgba(148, 163, 184, 0.24);
            --border-secondary: rgba(148, 163, 184, 0.16);
            --border-accent: rgba(204, 45, 93, 0.45);
            --border-subtle: rgba(148, 163, 184, 0.22);

            --accent-primary: #CC2D5D;
            --accent-hover: #E53E7B;

            --panel-bg: rgba(14, 11, 14, 0.94);
            --panel-border: rgba(148, 163, 184, 0.24);
            --panel-header-bg: rgba(148, 163, 184, 0.12);
            --panel-response-header-bg: rgba(148, 163, 184, 0.1);
            --panel-info-bg: rgba(148, 163, 184, 0.06);
            --code-surface: rgba(6, 5, 8, 0.95);

            --success-bg: rgba(76, 175, 128, 0.18);
            --success-border: rgba(111, 216, 157, 0.5);
            --success-text: #83F2C3;

            --error-bg: rgba(232, 92, 110, 0.18);
            --error-border: rgba(232, 92, 110, 0.55);
            --error-text: #FF9AA5;

            --info-bg: rgba(107, 163, 232, 0.18);
            --info-border: rgba(139, 185, 240, 0.55);
            --info-text: #9FC4FF;

            --warning-bg: rgba(255, 183, 77, 0.18);
            --warning-border: rgba(255, 183, 77, 0.55);
            --warning-text: #FFD7A1;

            --code-bg: rgba(16, 14, 17, 0.94);
            --code-text: #F4F5F7;
            --shadow: rgba(0, 0, 0, 0.5);
        }

        .dynamic-value {
            font-weight: 600;
            color: var(--text-primary);
            padding: 4px 8px;
            background: var(--bg-highlight);
            border-radius: 8px;
            border-bottom: 1px solid var(--border-accent);
        }

        /* === STEP STRUCTURE === */

        .step.locked {
            opacity: 0.35;
            pointer-events: none;
            filter: grayscale(50%);
        }

        .step.locked button,
        .step.locked .result,
        .step.locked .network-grid,
        .step.locked .deposit-box,
        .step.locked .step-response {
            display: none;
        }


        label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            transition: border-color 0.2s ease, background 0.2s ease;
            min-height: 44px; /* Match dropdown height */
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        input:disabled {
            background: var(--bg-tertiary);
            color: var(--text-tertiary);
            cursor: not-allowed;
        }

        small {
            display: block;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 4px;
        }

        small a {
            color: var(--accent-primary);
            text-decoration: none;
        }

        small a:hover {
            text-decoration: underline;
        }

        .required {
            color: var(--error-border);
        }

        .optional {
            color: var(--text-secondary);
            font-size: 0.9em;
            font-weight: normal;
        }

        .divider {
            height: 1px;
            background: var(--border-primary);
            margin: 16px 0;
        }

        button {
            background: var(--accent-primary);
            color: var(--bg-primary);
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 12px;
            font-weight: 500;
            transition: background 0.2s ease, transform 0.1s ease;
        }

        button:hover {
            background: var(--accent-hover);
        }

        button:disabled {
            background: var(--border-primary);
            color: var(--text-tertiary);
            cursor: not-allowed;
        }

        /* === MESSAGES === */
        .result {
            margin-top: 16px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        .result.success {
            background: var(--success-bg);
            border: 1px solid var(--success-border);
            color: var(--success-text);
            display: block;
        }

        .result.error {
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            color: var(--error-text);
            display: block;
        }

        /* === NETWORK GRID === */
        .network-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 16px;
        }

        .token-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 16px;
        }

        .token-selector {
            margin-top: 20px;
        }

        .network-card {
            padding: 8px;
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.2s;
            height: 80px;
            justify-content: center;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .network-card:hover {
            border-color: var(--border-accent);
            background: var(--bg-tertiary);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .network-card.selected {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .network-card.selected .network-tokens {
            color: var(--text-secondary);
        }

        /* Light theme - selected card styling */
        html[data-theme="light"] .network-card.selected {
            background: var(--text-primary);
            color: var(--bg-primary);
            border-color: var(--text-primary);
        }

        html[data-theme="light"] .network-card.selected .network-tokens {
            color: var(--bg-secondary);
        }

        .network-card img {
            object-fit: contain;
            border-radius: 50%;
        }

        /* === DEPOSIT BOX === */
        .deposit-box {
            margin-top: 16px;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            word-break: break-all;
            font-family: 'Monaco', monospace;
            font-size: 13px;
            color: var(--text-primary);
        }

        .api-hint {
            margin-top: 8px;
            padding: 8px;
            background: var(--bg-highlight);
            border-radius: 6px;
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .api-hint i {
            flex-shrink: 0;
            opacity: 0.7;
            color: var(--text-secondary);
        }

        .api-hint code {
            font-family: 'Monaco', monospace;
            font-size: 11px;
            padding: 2px 4px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            color: var(--accent-primary);
        }

        /* === TRANSACTION DISPLAY === */
        .swap-route {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 16px 0 8px 0;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .swap-route-item {
            font-weight: 600;
            color: var(--text-primary);
        }

        .swap-route-arrow {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .transaction-container {
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-primary);
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 6px;
        }

        .transaction-title {
            font-weight: 500;
            font-size: 11px;
            margin-bottom: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .transaction-card {
            padding: 12px;
            background: var(--bg-primary);
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
        }

        .transaction-card:hover {
            background: var(--bg-tertiary);
        }

        .transaction-logo {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-secondary);
            padding: 2px;
            flex-shrink: 0;
        }

        .transaction-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .transaction-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transaction-type {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 4px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .transaction-type.input {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .transaction-type.output {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .transaction-amount-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .network-logo {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--bg-secondary);
            padding: 2px;
        }

        .transaction-amount {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .transaction-network {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 1px;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            text-transform: lowercase;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            display: inline-block;
        }

        .transaction-details {
            margin-left: 32px;
            margin-top: 8px;
            padding-right: 110px; /* Leave space for right-aligned info */
        }

        .transaction-details.no-indent {
            margin-left: 0;
        }

        .transaction-detail-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .transaction-detail-row {
            display: flex;
            align-items: center;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .transaction-detail-label {
            font-weight: 500;
            margin-right: 4px;
        }

        .transaction-detail-value {
            font-size: 11px;
        }

        .transaction-hash {
            font-family: monospace;
            font-size: 11px;
        }

        .transaction-hash-link {
            color: var(--accent-primary);
            text-decoration: none;
        }

        .transaction-hash-link:hover {
            opacity: 0.8;
        }

        .transaction-waiting {
            color: var(--text-tertiary);
            font-size: 11px;
            font-style: italic;
        }

        /* === JSON DISPLAY === */
        .json-text {
            color: #d4d4d4;
            font-size: 12px;
            line-height: 1.6;
            margin: 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .syntax-key {
            color: var(--text-secondary);
        }

        .syntax-value {
            color: var(--text-primary);
        }

        .syntax-string {
            color: var(--success-text);
        }

        .syntax-number {
            color: var(--info-text);
        }

        .syntax-boolean {
            color: var(--warning-text);
        }

        .syntax-null {
            color: var(--error-text);
        }

        /* === VALIDATION ERRORS === */
        .validation-error {
            color: var(--error-text);
            font-size: 12px;
            margin-top: 4px;
        }

        /* === JSON RESPONSE === */
        .json-response {
            border: 1px solid var(--panel-border);
            border-radius: 18px;
            background: var(--panel-bg);
            box-shadow: 0 26px 60px -45px rgba(2, 12, 27, 0.55);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .json-header {
            background: var(--panel-header-bg);
            padding: 16px 18px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: 600;
            border-bottom: 1px solid rgba(148, 163, 184, 0.16);
            color: var(--text-primary);
            position: relative;
        }

        .json-header::after {
            content: '';
            position: absolute;
            left: 18px;
            right: 18px;
            bottom: -1px;
            height: 2px;
            background: rgba(148, 163, 184, 0.22);
            border-radius: 999px;
        }

        .request-content {
            display: none;
            padding: 16px;
            background: var(--code-surface);
            color: var(--code-text);
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.6;
            overflow: auto;
            max-height: 220px;
            border-top: 1px solid var(--border-secondary);
            scrollbar-gutter: stable both-edges;
            min-height: 0;
        }

        .request-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .request-content .plain-curl {
            display: none;
        }

        .json-content {
            background: var(--code-surface);
            padding: 16px;
            max-height: calc(420px - 56px);
            overflow-x: auto;
            overflow-y: auto;
            color: var(--code-text);
            flex: 1;
            scrollbar-gutter: stable both-edges;
            min-height: 0;
        }

        .request-content::-webkit-scrollbar,
        .json-content::-webkit-scrollbar {
            width: 8px;
        }

        .request-content::-webkit-scrollbar-track,
        .json-content::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.08);
        }

        .request-content::-webkit-scrollbar-thumb,
        .json-content::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.3);
            border-radius: 8px;
        }

        .request-content::-webkit-scrollbar-thumb:hover,
        .json-content::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.45);
        }

        /* === JSON VIEWER STYLING === */
        .json-content .json-formatter-row {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
        }

        .json-content .json-formatter-row .json-formatter-toggler-link {
            cursor: pointer;
            color: #858585;
            text-decoration: none;
            user-select: none;
        }

        .json-content .json-formatter-row .json-formatter-toggler-link:hover {
            color: #d4d4d4;
        }

        .json-content .json-formatter-key {
            color: var(--json-key);
        }

        .json-content .json-formatter-string {
            color: var(--json-string);
        }

        .json-content .json-formatter-number {
            color: var(--json-number);
        }

        .json-content .json-formatter-boolean {
            color: var(--json-boolean);
        }

        .json-content .json-formatter-null {
            color: var(--json-null);
        }

        .json-content .json-formatter-undefined {
            color: var(--json-null);
        }

        .json-content .json-formatter-bracket,
        .json-content .json-formatter-colon {
            color: var(--json-bracket);
        }

        .json-content .json-formatter-preview-text {
            color: #858585;
            font-style: italic;
        }

        .json-content .json-formatter-children {
            margin-left: 20px;
        }

        .json-content::-webkit-scrollbar {
            width: 8px;
        }

        .json-content::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.08);
        }

        .json-content::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.35);
            border-radius: 8px;
        }

        .json-content::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.55);
        }


        /* === ENHANCED MOBILE RESPONSIVE STYLES === */

        /* Tablet styles */
        @media (max-width: 768px) {
            /* Fix Safari zoom on input focus for iOS devices */
            input, select, textarea {
                font-size: 16px;
            }

            .capabilities-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Process flow already vertical, just adjust spacing on mobile */
            .process-steps-vertical {
                padding-left: 28px;
                padding-right: 8px;
            }

            .process-step {
                gap: 8px 16px;
            }

            .process-step-desc {
                font-size: 12px;
            }

            /* Mobile friendly note adjustments */
            .mobile-friendly-note {
                padding: 12px;
                gap: 10px;
            }

            .note-icon {
                font-size: 18px;
            }

            .note-title {
                font-size: 13px;
            }

            .note-desc {
                font-size: 12px;
            }

            .subtitle {
                font-size: 14px;
            }

            /* Transaction details responsive */
            .transaction-details {
                margin-left: 0;
                padding-right: 0;
            }

            .transaction-info-box {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 8px;
                align-items: flex-end;
                width: 100%;
            }

            .transaction-info-details {
                align-items: flex-start;
                flex-direction: row;
                gap: 8px;
                flex-wrap: wrap;
            }

        }

        /* Mobile styles */
        @media (max-width: 480px) {
            /* Fix Safari zoom on input focus */
            input, select, textarea {
                font-size: 16px !important;
            }

            .logo {
                width: 36px;
                height: 36px;
            }

            /* Overview section */
            .overview-section h2 {
                font-size: 20px;
                line-height: 1.3;
            }

            .overview-section p {
                font-size: 14px;
            }

            /* Capabilities grid - single column on mobile */
            .capabilities-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .capability-item {
                padding: 12px;
            }

            /* Steps */
            .step {
                margin-bottom: 20px;
                padding: 16px;
            }

            .step h2 {
                font-size: 18px;
            }

            .step-description {
                font-size: 13px;
            }

            /* Buttons */
            button {
                font-size: 13px;
                padding: 10px 16px;
            }

            /* Network and token grids */
            .network-grid,
            .token-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 6px;
            }

            .network-card {
                height: 70px;
                font-size: 9px;
                padding: 6px;
            }

            /* Result boxes */
            .result {
                font-size: 12px;
                padding: 10px;
            }

            /* Code blocks */
            .json-box {
                font-size: 11px;
            }

            /* Transaction cards */
            .transaction-card {
                padding: 8px;
            }

            .transaction-amount {
                font-size: 13px;
            }

            .network-logo {
                width: 20px;
                height: 20px;
            }

            /* Status guide */
            #statusGuide {
                font-size: 11px;
                padding: 12px;
            }

            #statusGuide .transaction-detail-label {
                min-width: 120px;
            }

        }

        /* Small mobile devices */
        @media (max-width: 375px) {
            .overview-section h2 {
                font-size: 18px;
            }

            .network-grid,
            .token-grid {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }

            .network-card {
                height: 65px;
                font-size: 8px;
            }

            button {
                font-size: 12px;
                padding: 8px 12px;
            }
        }

    </style>
</head>
<body class="font-sans min-h-screen bg-surface-soft dark:bg-surface-dark text-ink dark:text-ink-invert transition-colors duration-300 py-6">
    <!-- Theme Toggle Button -->
    <div class="w-full max-w-8xl mx-auto flex flex-col gap-8 md:flex-row md:items-start md:gap-10 lg:gap-12 px-0 lg:px-5">
        <!-- Navigation Sidebar -->
        <nav class="nav-sidebar hidden md:flex md:flex-col sticky top-[4rem] h-[calc(100vh-4rem)] w-[18rem] shrink-0 border-r border-slate-200/70 dark:border-white/10 transition-transform duration-200">
            <div class="flex-1 overflow-y-auto pr-5 pt-1 pb-6 space-y-6">
                <div>
                    <p class="px-4 mb-3 text-[11px] font-semibold uppercase tracking-[0.32em] text-ink-soft dark:text-ink-invert-soft">Documentation</p>
                    <ul class="flex flex-col gap-1 text-sm">
                        <li>
                            <a href="#overview" class="nav-link group flex w-full items-center gap-3 rounded-xl px-4 py-2 text-left text-ink-soft transition hover:bg-slate-100/70 hover:text-ink dark:text-ink-invert-soft dark:hover:bg-white/5 dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.active]:shadow-sm [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="nav-overview">Overview</a>
                        </li>
                        <li>
                            <a href="#step1" class="nav-link group flex w-full items-center gap-3 rounded-xl px-4 py-2 text-left text-ink-soft transition hover:bg-slate-100/70 hover:text-ink dark:text-ink-invert-soft dark:hover:bg-white/5 dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.active]:shadow-sm [&.locked]:opacity-40 [&.locked]:cursor-not-allowed">Step 1: Setup Destination</a>
                        </li>
                        <li>
                            <a href="#step2" class="nav-link group flex w-full items-center gap-3 rounded-xl px-4 py-2 text-left text-ink-soft transition hover:bg-slate-100/70 hover:text-ink dark:text-ink-invert-soft dark:hover:bg-white/5 dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.active]:shadow-sm [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="nav-step2">Step 2: Select Source</a>
                        </li>
                        <li class="multiple-tokens-nav hidden">
                            <a href="#step3-destination" class="nav-link group flex w-full items-center gap-3 rounded-xl px-4 py-2 text-left text-ink-soft transition hover:bg-slate-100/70 hover:text-ink dark:text-ink-invert-soft dark:hover:bg-white/5 dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.active]:shadow-sm [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="nav-step3-destination">Step 3: Select Destination</a>
                        </li>
                        <li>
                            <a href="#step3" class="nav-link group flex w-full items-center gap-3 rounded-xl px-4 py-2 text-left text-ink-soft transition hover:bg-slate-100/70 hover:text-ink dark:text-ink-invert-soft dark:hover:bg-white/5 dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.active]:shadow-sm [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="nav-step3"><span id="nav-step3-label">Step 3:</span> Get Quote</a>
                        </li>
                        <li>
                            <a href="#step4" class="nav-link group flex w-full items-center gap-3 rounded-xl px-4 py-2 text-left text-ink-soft transition hover:bg-slate-100/70 hover:text-ink dark:text-ink-invert-soft dark:hover:bg-white/5 dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.active]:shadow-sm [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="nav-step4"><span id="nav-step4-label">Step 4:</span> Create Swap</a>
                        </li>
                        <li>
                            <a href="#step5" class="nav-link group flex w-full items-center gap-3 rounded-xl px-4 py-2 text-left text-ink-soft transition hover:bg-slate-100/70 hover:text-ink dark:text-ink-invert-soft dark:hover:bg-white/5 dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.active]:shadow-sm [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="nav-step5"><span id="nav-step5-label">Step 5:</span> Check Status</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay hidden fixed inset-0 z-[9998] bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300 [&.active]:opacity-100 [&.active]:pointer-events-auto [&.active]:block [&.active_.mobile-menu]:translate-x-0" id="mobileMenuOverlay">
            <div class="mobile-menu flex h-full w-72 max-w-full flex-col bg-surface dark:bg-surface-dark shadow-2xl transform -translate-x-full transition-transform duration-300">
                <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200/70 dark:border-white/10">
                    <h3 class="text-sm font-semibold uppercase tracking-[0.18em] text-ink-soft dark:text-ink-invert-soft">Navigation</h3>
                    <button class="mobile-menu-close text-2xl text-ink-soft hover:text-ink dark:text-ink-invert-soft" id="mobileMenuClose" aria-label="Close Menu">×</button>
                </div>
                <ul class="mobile-nav-list flex-1 overflow-y-auto py-4 text-sm">
                    <li>
                        <a href="#overview" class="mobile-nav-link block px-5 py-2.5 text-ink-soft transition hover:bg-surface-highlight hover:text-ink dark:text-ink-invert-soft dark:hover:bg-surface-dark-muted dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="mobile-nav-overview">Overview</a>
                    </li>
                    <li>
                        <a href="#step1" class="mobile-nav-link block px-5 py-2.5 text-ink-soft transition hover:bg-surface-highlight hover:text-ink dark:text-ink-invert-soft dark:hover:bg-surface-dark-muted dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.locked]:opacity-40 [&.locked]:cursor-not-allowed">Step 1: Setup Destination</a>
                    </li>
                    <li>
                        <a href="#step2" class="mobile-nav-link block px-5 py-2.5 text-ink-soft transition hover:bg-surface-highlight hover:text-ink dark:text-ink-invert-soft dark:hover:bg-surface-dark-muted dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="mobile-nav-step2">Step 2: Select Source</a>
                    </li>
                    <li class="multiple-tokens-nav hidden">
                        <a href="#step3-destination" class="mobile-nav-link block px-5 py-2.5 text-ink-soft transition hover:bg-surface-highlight hover:text-ink dark:text-ink-invert-soft dark:hover:bg-surface-dark-muted dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="mobile-nav-step3-destination">Step 3: Select Destination</a>
                    </li>
                    <li>
                        <a href="#step3" class="mobile-nav-link block px-5 py-2.5 text-ink-soft transition hover:bg-surface-highlight hover:text-ink dark:text-ink-invert-soft dark:hover:bg-surface-dark-muted dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="mobile-nav-step3"><span id="mobile-nav-step3-label">Step 3:</span> Get Quote</a>
                    </li>
                    <li>
                        <a href="#step4" class="mobile-nav-link block px-5 py-2.5 text-ink-soft transition hover:bg-surface-highlight hover:text-ink dark:text-ink-invert-soft dark:hover:bg-surface-dark-muted dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="mobile-nav-step4"><span id="mobile-nav-step4-label">Step 4:</span> Create Swap</a>
                    </li>
                    <li>
                        <a href="#step5" class="mobile-nav-link block px-5 py-2.5 text-ink-soft transition hover:bg-surface-highlight hover:text-ink dark:text-ink-invert-soft dark:hover:bg-surface-dark-muted dark:hover:text-ink-invert [&.active]:bg-brand/10 [&.active]:text-brand [&.active]:font-semibold [&.locked]:opacity-40 [&.locked]:cursor-not-allowed" id="mobile-nav-step5"><span id="mobile-nav-step5-label">Step 5:</span> Check Status</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="container flex-1 w-full max-w-3xl mx-auto md:mx-0 lg:max-w-3xl flex flex-col gap-10 px-5 sm:px-6 md:px-0 lg:pr-6">
        <div class="header flex flex-col items-start gap-3 mt-2 mb-10">
            <button class="mobile-menu-btn flex items-center justify-center gap-1 rounded-md border border-slate-200/60 bg-white/80 px-3 py-2 text-sm font-medium text-ink shadow-sm transition dark:border-white/10 dark:bg-surface-dark/70 lg:hidden" id="mobileMenuBtn" aria-label="Toggle Navigation Menu">
                <span class="block h-0.5 w-5 rounded bg-current transition-transform duration-300"></span>
                <span class="block h-0.5 w-5 rounded bg-current transition-opacity duration-300"></span>
                <span class="block h-0.5 w-5 rounded bg-current transition-transform duration-300"></span>
            </button>
            <span class="header-meta inline-flex items-center rounded-full bg-brand/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:bg-brand/20">Documentation</span>
            <h1 class="page-title text-4xl font-bold text-ink dark:text-ink-invert sm:text-[42px]">Layerswap Deposit API Tutorial</h1>
            <p class="subtitle max-w-2xl text-base text-ink-soft dark:text-ink-invert-soft sm:text-lg">Interactive guide to integrate cross-chain deposits into your wallet or application.</p>
        </div>

        <!-- Overview -->
        <div id="overview" class="space-y-6">
            <h2 class="text-2xl font-semibold text-ink dark:text-ink-invert">Accept Deposits from Any Chain, Instantly</h2>
            <p class="text-base leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                Give users a single deposit address. They send from any chain – funds automatically bridge and arrive to your destination. That's it.
            </p>

            <div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                <div class="flex flex-col items-center justify-center rounded-2xl border border-slate-200/60 bg-white/90 px-6 py-5 text-center shadow-sm dark:border-white/10 dark:bg-surface-dark/80">
                    <span class="text-3xl font-semibold text-brand">70+</span>
                    <span class="mt-1 text-[11px] uppercase tracking-[0.35em] text-ink-soft dark:text-ink-invert-soft">Networks</span>
                </div>
                <div class="flex flex-col items-center justify-center rounded-2xl border border-slate-200/60 bg-white/90 px-6 py-5 text-center shadow-sm dark:border-white/10 dark:bg-surface-dark/80">
                    <span class="text-3xl font-semibold text-brand">&lt;10s</span>
                    <span class="mt-1 text-[11px] uppercase tracking-[0.35em] text-ink-soft dark:text-ink-invert-soft">Processing</span>
                </div>
                <div class="flex flex-col items-center justify-center rounded-2xl border border-slate-200/60 bg-white/90 px-6 py-5 text-center shadow-sm dark:border-white/10 dark:bg-surface-dark/80">
                    <span class="text-3xl font-semibold text-brand">$1B+</span>
                    <span class="mt-1 text-[11px] uppercase tracking-[0.35em] text-ink-soft dark:text-ink-invert-soft">Volume</span>
                </div>
            </div>

            <!-- Process Flow -->
            <div class="space-y-6">
                <h3 class="text-sm font-semibold uppercase tracking-[0.32em] text-ink-soft dark:text-ink-invert-soft">Integration Flow</h3>

                <div role="list" class="steps ml-3.5 mt-8 space-y-6 pl-1">
                    <div role="listitem" class="step relative flex items-start gap-4 pb-5">
                        <div class="relative flex flex-col items-center pt-1">
                            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-white text-xs font-semibold text-brand shadow-sm ring-1 ring-slate-200/60 dark:bg-surface-dark-soft dark:text-brand dark:ring-white/20">1</div>
                            <div class="mt-2 h-full w-px bg-slate-200/70 dark:bg-white/15"></div>
                        </div>
                        <div class="flex-1 space-y-1.5">
                            <p class="text-sm font-semibold text-ink dark:text-ink-invert">Set Your Destination</p>
                            <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">Configure your wallet address and specify which network and token you want to receive (e.g., USDC on Base, ETH on Arbitrum).</p>
                        </div>
                    </div>

                    <div role="listitem" class="step relative flex items-start gap-4 pb-5">
                        <div class="relative flex flex-col items-center pt-1">
                            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-white text-xs font-semibold text-brand shadow-sm ring-1 ring-slate-200/60 dark:bg-surface-dark-soft dark:text-brand dark:ring-white/20">2</div>
                            <div class="mt-2 h-full w-px bg-slate-200/70 dark:bg-white/15"></div>
                        </div>
                        <div class="flex-1 space-y-1.5">
                            <p class="text-sm font-semibold text-ink dark:text-ink-invert">Fetch Available Sources</p>
                            <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">Call GET /sources endpoint – returns all networks and tokens your users can send from to reach your destination (70+ options).</p>
                        </div>
                    </div>

                    <div role="listitem" class="step relative flex items-start gap-4 pb-5">
                        <div class="relative flex flex-col items-center pt-1">
                            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-white text-xs font-semibold text-brand shadow-sm ring-1 ring-slate-200/60 dark:bg-surface-dark-soft dark:text-brand dark:ring-white/20">3</div>
                            <div class="mt-2 h-full w-px bg-slate-200/70 dark:bg-white/15"></div>
                        </div>
                        <div class="flex-1 space-y-1.5">
                            <p class="text-sm font-semibold text-ink dark:text-ink-invert">User Selects Source</p>
                            <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">Display the available options to your user and let them choose which network and token they have (e.g., USDT on BSC, ETH on Polygon).</p>
                        </div>
                    </div>

                    <div role="listitem" class="step relative flex items-start gap-4 pb-5">
                        <div class="relative flex flex-col items-center pt-1">
                            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-white text-xs font-semibold text-brand shadow-sm ring-1 ring-slate-200/60 dark:bg-surface-dark-soft dark:text-brand dark:ring-white/20">4</div>
                            <div class="mt-2 h-full w-px bg-slate-200/70 dark:bg-white/15"></div>
                        </div>
                        <div class="flex-1 space-y-1.5">
                            <p class="text-sm font-semibold text-ink dark:text-ink-invert">Generate Deposit Address</p>
                            <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">Call POST /swaps with the selected route – the API creates a unique deposit address and handles all bridging logic.</p>
                        </div>
                    </div>

                    <div role="listitem" class="step relative flex items-start gap-4 pb-5">
                        <div class="relative flex flex-col items-center pt-1">
                            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-white text-xs font-semibold text-brand shadow-sm ring-1 ring-slate-200/60 dark:bg-surface-dark-soft dark:text-brand dark:ring-white/20">5</div>
                            <div class="mt-2 h-full w-px bg-slate-200/70 dark:bg-white/15"></div>
                        </div>
                        <div class="flex-1 space-y-1.5">
                            <p class="text-sm font-semibold text-ink dark:text-ink-invert">Display to User</p>
                            <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">Show the deposit address with clear instructions so the user sends from the source network they selected.</p>
                        </div>
                    </div>

                    <div role="listitem" class="step relative flex items-start gap-4 pb-5">
                        <div class="relative flex flex-col items-center pt-1">
                            <div class="flex h-7 w-7 items-center justify-center rounded-full bg-white text-xs font-semibold text-brand shadow-sm ring-1 ring-slate-200/60 dark:bg-surface-dark-soft dark:text-brand dark:ring-white/20">6</div>
                            <div class="mt-2 h-full w-px bg-transparent"></div>
                        </div>
                        <div class="flex-1 space-y-1.5">
                            <p class="text-sm font-semibold text-ink dark:text-ink-invert">Receive Funds</p>
                            <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">User sends tokens → Layerswap detects the deposit → automatically converts and bridges → delivers to your wallet on the destination network (usually ~10s).</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-start gap-4 rounded-2xl border border-brand/20 bg-brand/10 px-5 py-4 text-sm text-ink dark:border-brand/40 dark:bg-brand/15 dark:text-ink-invert">
                <div class="mt-1 text-lg text-brand dark:text-brand-dark">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <div class="space-y-1">
                    <div class="text-sm font-semibold uppercase tracking-[0.18em] text-brand dark:text-brand-dark">No Wallet Connections Required</div>
                    <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">Just a simple deposit address—no WalletConnect, no browser extensions, no popups. Users can send from any wallet app (MetaMask, Trust Wallet, exchange wallets, hardware wallets) using their preferred method. Perfect for mobile users.</p>
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <!-- Configuration -->
        <div class="mt-12 space-y-6">
            <h2 class="text-xl font-semibold text-ink dark:text-ink-invert">Configuration</h2>
            <p class="text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">Set up your API credentials to get started.</p>

            <div class="grid gap-4 lg:grid-cols-2">
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-ink dark:text-ink-invert-soft">Base API URL</label>
                    <input type="text" value="https://api.layerswap.io/api/v2" disabled class="w-full rounded-lg border border-slate-200/70 bg-white px-4 py-3 text-sm text-ink shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/20 disabled:cursor-not-allowed disabled:border-slate-200 disabled:bg-surface-soft disabled:text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert dark:focus:border-brand dark:focus:ring-brand/30 dark:disabled:bg-surface-dark-muted dark:disabled:text-ink-invert-soft">
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-medium text-ink dark:text-ink-invert-soft">API Key <span class="text-xs font-normal text-ink-soft dark:text-ink-invert-soft">(Optional)</span></label>
                    <input type="text" id="apiKey" value="2XB8/E0WYmRZkwxJSB06nqL3DKy6IdlpJQr2vb6JsE8M55Dl5DmaMWMNJCzRm5bX8p/mBBn1moR+EdEzAMtb/g" placeholder="Optional - for higher rate limits & analytics" aria-label="API Key" class="w-full rounded-lg border border-slate-200/70 bg-white px-4 py-3 text-sm text-ink shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/20 dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert dark:focus:border-brand dark:focus:ring-brand/30">
                    <small class="block text-xs leading-relaxed text-ink-soft dark:text-ink-invert-soft">No API key needed for basic usage. Get one at <a class="text-brand underline-offset-2 hover:underline" href="https://www.layerswap.io/dashboard" target="_blank">layerswap.io/dashboard</a> for higher rate limits and analytics.</small>
                </div>
            </div>
        </div>

        <!-- Step 1: Setup Destination -->
        <div class="step relative flex flex-col gap-8 border-b border-slate-200/60 pb-10 mb-12 scroll-mt-24 dark:border-white/10" id="step1">
            <div class="step-content flex-1 min-w-0 space-y-5">
                <span class="step-number inline-flex items-center rounded-full border border-slate-200/60 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-brand dark:border-brand/40 dark:text-brand">Step 1:</span>
                <h2 class="text-xl font-semibold text-ink dark:text-ink-invert">Setup Destination</h2>
                <p class="step-description text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                    Configure your destination wallet and select the appropriate integration mode for your use case.
                </p>

                <!-- Mode Selector -->
                <div class="rounded-2xl border border-slate-200/60 bg-white/90 p-4 shadow-sm dark:border-white/10 dark:bg-surface-dark/80">
                    <span class="block text-sm font-semibold text-ink dark:text-ink-invert">Select Your Use Case:</span>
                    <div class="mt-4 grid gap-3 md:grid-cols-2">
                        <label class="group relative flex cursor-pointer flex-col gap-2 rounded-xl border border-slate-200/60 bg-white/95 p-4 shadow-sm transition hover:border-brand hover:bg-brand/5 dark:border-white/10 dark:bg-surface-dark/70 dark:hover:border-brand dark:hover:bg-brand/10">
                            <input type="radio" name="tokenMode" value="single" checked onchange="handleModeChange()" class="peer sr-only">
                            <span class="text-sm font-semibold text-ink transition peer-checked:text-brand dark:text-ink-invert">Fixed Destination Token</span>
                            <span class="text-xs leading-relaxed text-ink-soft transition peer-checked:text-brand dark:text-ink-invert-soft"><strong class="font-semibold">DApp Integration:</strong> For prediction markets, DEXs, or apps requiring a specific token (e.g., only USDC)</span>
                        </label>
                        <label class="group relative flex cursor-pointer flex-col gap-2 rounded-xl border border-slate-200/60 bg-white/95 p-4 shadow-sm transition hover:border-brand hover:bg-brand/5 dark:border-white/10 dark:bg-surface-dark/70 dark:hover:border-brand dark:hover:bg-brand/10">
                            <input type="radio" name="tokenMode" value="multiple" onchange="handleModeChange()" class="peer sr-only">
                            <span class="text-sm font-semibold text-ink transition peer-checked:text-brand dark:text-ink-invert">Multiple Destination Tokens</span>
                            <span class="text-xs leading-relaxed text-ink-soft transition peer-checked:text-brand dark:text-ink-invert-soft"><strong class="font-semibold">Wallet Integration:</strong> Accept various tokens and deliver their respective counterparts on your network</span>
                        </label>
                    </div>
                </div>

                <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-3" id="destinationFields">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-ink dark:text-ink-invert">Your Wallet Address <span class="text-brand">*</span></label>
                        <input type="text" id="walletAddress" placeholder="0x..." class="w-full rounded-lg border border-slate-200/70 bg-white px-4 py-3 text-sm text-ink shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/20 dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert dark:focus:border-brand dark:focus:ring-brand/30">
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-ink dark:text-ink-invert">Destination Network <span class="text-brand">*</span></label>
                        <div class="custom-dropdown relative w-full" id="destinationNetworkDropdown">
                            <div class="dropdown-selected flex items-center justify-between rounded-lg border border-slate-200/60 bg-white px-4 py-3 text-sm font-medium text-ink shadow-sm transition hover:border-brand focus:outline-none dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert" id="destinationNetworkSelected">
                                <span class="selected-text block truncate pr-3">Select a network</span>
                                <svg class="dropdown-arrow h-3 w-3 text-slate-400 transition-transform" width="12" height="8" viewBox="0 0 12 8" fill="none">
                                    <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="dropdown-content hidden absolute left-0 right-0 z-40 mt-2 w-full max-w-md rounded-xl border border-slate-200/70 bg-white shadow-2xl dark:border-white/10 dark:bg-surface-dark-soft" id="destinationNetworkContent" style="display: none;">
                                <div class="dropdown-search sticky top-0 z-10 border-b border-slate-200/70 bg-white px-3 py-3 dark:border-white/10 dark:bg-surface-dark-soft">
                                    <input type="text" id="networkSearchInput" placeholder="Search networks..." class="w-full rounded-md border border-slate-200/60 bg-white px-3 py-2 text-sm text-ink outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/30 dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert">
                                </div>
                                <div class="dropdown-sections space-y-4">
                                    <div class="featured-networks space-y-2" id="featuredNetworks">
                                        <div class="section-title px-4 text-xs font-semibold uppercase tracking-[0.35em] text-ink-soft dark:text-ink-invert-soft">Featured Networks</div>
                                        <div class="featured-list space-y-1" id="featuredNetworksList">
                                            <!-- Featured networks will be populated here -->
                                        </div>
                                    </div>
                                    <div class="all-networks space-y-2" id="allNetworks">
                                        <div class="section-title px-4 text-xs font-semibold uppercase tracking-[0.35em] text-ink-soft dark:text-ink-invert-soft">All Networks</div>
                                        <div class="networks-list space-y-1" id="allNetworksList">
                                            <!-- All networks will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Hidden select for form compatibility -->
                        <select id="destinationNetwork" style="display: none;">
                            <!-- Options will be populated dynamically from API -->
                        </select>
                    </div>

                    <div class="space-y-2" id="destinationTokenGroup">
                        <label class="block text-sm font-medium text-ink dark:text-ink-invert">Destination Token <span class="text-brand">*</span></label>
                        <div class="custom-dropdown relative w-full" id="destinationTokenDropdown">
                            <div class="dropdown-selected flex items-center justify-between rounded-lg border border-slate-200/60 bg-white px-4 py-3 text-sm font-medium text-ink shadow-sm transition hover:border-brand focus:outline-none dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert" id="destinationTokenSelected">
                                <span class="selected-text block truncate pr-3">Select a token</span>
                                <svg class="dropdown-arrow h-3 w-3 text-slate-400 transition-transform" width="12" height="8" viewBox="0 0 12 8" fill="none">
                                    <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="dropdown-content hidden absolute left-0 right-0 z-40 mt-2 w-full max-w-md rounded-xl border border-slate-200/70 bg-white shadow-2xl dark:border-white/10 dark:bg-surface-dark-soft" id="destinationTokenContent" style="display: none;">
                                <div class="dropdown-search sticky top-0 z-10 border-b border-slate-200/70 bg-white px-3 py-3 dark:border-white/10 dark:bg-surface-dark-soft">
                                    <input type="text" id="tokenSearchInput" placeholder="Search tokens..." class="w-full rounded-md border border-slate-200/60 bg-white px-3 py-2 text-sm text-ink outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/30 dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert">
                                </div>
                                <div class="dropdown-sections space-y-2">
                                    <div class="all-tokens space-y-1" id="allTokens">
                                        <div class="tokens-list space-y-1" id="allTokensList">
                                            <!-- Tokens will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Hidden select for form compatibility -->
                        <select id="destinationToken" style="display: none;">
                            <!-- Options will be populated dynamically based on selected network -->
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Get Sources -->
        <div class="step locked relative flex flex-col gap-8 border-b border-slate-200/60 pb-10 mb-12 scroll-mt-24 dark:border-white/10" id="step2">
            <div class="step-content flex-1 min-w-0 space-y-4">
                <span class="step-number inline-flex items-center rounded-full border border-slate-200/60 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-brand dark:border-brand/40 dark:text-brand">Step 2:</span>
                <h2 class="text-xl font-semibold text-ink dark:text-ink-invert">Select Source</h2>
                <p class="step-description single-token-mode text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                    Select which networks can send tokens to receive <span id="destinationNetworkDisplay" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand">your token</span> on your network.
                </p>
                <p class="step-description multiple-tokens-mode text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft" style="display: none;">
                    Select the source network and token - users will receive the matching token on your destination network.
                </p>

                <div class="api-hint mt-3 flex items-start gap-2 rounded-lg border border-slate-200/60 bg-surface-soft px-3 py-2 text-xs leading-relaxed text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                    <i class="fas fa-info-circle text-sm text-brand"></i>
                    <span>The <code class="rounded bg-brand/10 px-1 py-0.5 font-mono text-[11px] text-brand">has_deposit_address=true</code> parameter ensures we only show sources that support generating deposit addresses, which is essential for the deposit flow.</span>
                </div>

                <button onclick="getSources()" id="getSourcesBtn" disabled aria-label="Fetch available source networks" class="inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand disabled:cursor-not-allowed disabled:border-transparent disabled:bg-slate-200 disabled:text-ink-soft dark:bg-brand dark:hover:bg-brand-dark dark:focus-visible:outline-brand dark:disabled:bg-white/10 dark:disabled:text-ink-invert-soft">Get Sources</button>

                <div id="step2-result" class="result-box hidden"></div>

                <div class="network-grid hidden grid grid-cols-[repeat(auto-fill,minmax(148px,1fr))] gap-3" id="sourceNetworks"></div>

                <!-- Token selector for multiple tokens mode -->
                <div class="token-selector hidden" id="sourceTokenSelector">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-ink dark:text-ink-invert">Source Token <span class="text-brand">*</span></label>
                        <select id="sourceToken" onchange="handleSourceTokenSelect()" class="w-full rounded-lg border border-slate-200/70 bg-white px-4 py-3 text-sm text-ink shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/20 dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert dark:focus:border-brand dark:focus:ring-brand/30">
                            <option value="">Select a token</option>
                        </select>
                    </div>
                </div>

                <div class="hidden rounded-xl border border-brand/20 bg-brand/10 px-4 py-3 text-sm font-medium text-ink-soft dark:border-brand/40 dark:bg-brand/20 dark:text-ink-invert-soft" id="selectedNetworkInfo">
                    <span class="font-semibold text-ink dark:text-ink-invert">Selected:</span>
                    <span class="ml-2 inline-flex items-center gap-2">
                        <span id="selectedNetworkName" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand"></span>
                        <span id="selectedTokenName" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand"></span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Step 3: Select Destination (Multiple Tokens Mode Only) -->
        <div class="step locked multiple-tokens-step relative flex flex-col gap-8 border-b border-slate-200/60 pb-10 mb-12 scroll-mt-24 dark:border-white/10" id="step3-destination" style="display: none;">
            <div class="step-content flex-1 min-w-0 space-y-4">
                <span class="step-number inline-flex items-center rounded-full border border-slate-200/60 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-brand dark:border-brand/40 dark:text-brand">Step 3:</span>
                <h2 class="text-xl font-semibold text-ink dark:text-ink-invert">Select Destination</h2>
                <p class="step-description text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                    After the user selects a source, use the destinations endpoint to determine the token they'll receive on <span id="destNetworkForTokens" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand">your destination network</span>.
                </p>

                <button onclick="getDestinationTokens()" id="getDestTokensBtn" disabled aria-label="Fetch available destination tokens" class="inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand disabled:cursor-not-allowed disabled:border-transparent disabled:bg-slate-200 disabled:text-ink-soft dark:bg-brand dark:hover:bg-brand-dark dark:focus-visible:outline-brand dark:disabled:bg-white/10 dark:disabled:text-ink-invert-soft">Get Available Tokens</button>

                <div id="step3-destination-result" class="result-box hidden"></div>

                <div class="token-grid hidden grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-3" id="destinationTokens"></div>

                <div class="hidden rounded-xl border border-brand/20 bg-brand/10 px-4 py-3 text-sm font-medium text-ink-soft dark:border-brand/40 dark:bg-brand/20 dark:text-ink-invert-soft" id="selectedDestTokenInfo">
                    <span class="font-semibold text-ink dark:text-ink-invert">Selected:</span>
                    <span class="ml-2 dynamic-value" id="selectedDestTokenName"></span>
                </div>
            </div>
        </div>

        <!-- Step 3/4: Get Quote -->
        <div class="step locked relative flex flex-col gap-8 border-b border-slate-200/60 pb-10 mb-12 scroll-mt-24 dark:border-white/10" id="step3">
            <div class="step-content flex-1 min-w-0 space-y-4">
                <span class="step-number inline-flex items-center rounded-full border border-slate-200/60 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-brand dark:border-brand/40 dark:text-brand" id="step3-number">Step 3:</span>
                <h2 class="text-xl font-semibold text-ink dark:text-ink-invert">Get Quote (Optional)</h2>
                <p class="step-description text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                    Get a detailed quote for bridging from <span id="sourceNetworkQuoteDisplay" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand">your selected network</span> to <span id="destNetworkDisplay" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand">BASE MAINNET (ETH)</span>.
                </p>
                <p class="step-description mt-2 text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                    <strong>Note:</strong> Getting a quote is optional for creating a swap, but recommended to show users the exact fees, limits, and estimated processing time before they deposit.
                </p>

                <button onclick="getQuote()" id="quoteBtn" disabled aria-label="Get detailed transfer quote" class="inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand disabled:cursor-not-allowed disabled:border-transparent disabled:bg-slate-200 disabled:text-ink-soft dark:bg-brand dark:hover:bg-brand-dark dark:focus-visible:outline-brand dark:disabled:bg-white/10 dark:disabled:text-ink-invert-soft">Get Detailed Quote</button>

                <div id="step3-result" class="result-box hidden"></div>

                <div class="hidden" id="quoteDetails"></div>
            </div>

        </div>

        <!-- Step 4/5: Create Swap -->
        <div class="step locked relative flex flex-col gap-8 border-b border-slate-200/60 pb-10 mb-12 scroll-mt-24 dark:border-white/10" id="step4">
            <div class="step-content flex-1 min-w-0 space-y-4">
                <span class="step-number inline-flex items-center rounded-full border border-slate-200/60 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-brand dark:border-brand/40 dark:text-brand" id="step4-number">Step 4:</span>
                <h2 class="text-xl font-semibold text-ink dark:text-ink-invert">Create Swap</h2>
                <p class="step-description text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                    Create a swap to get your unique deposit address.
                </p>

                <div class="hidden rounded-2xl border border-slate-200/60 bg-white/95 p-4 shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="swapRequestFields">
                    <h4 class="text-xs font-semibold uppercase tracking-[0.35em] text-ink-soft dark:text-ink-invert-soft">Request Body</h4>
                    <div class="mt-4 grid gap-3 text-xs text-ink dark:text-ink-invert sm:grid-cols-2">
                        <div class="space-y-1">
                            <div class="text-[11px] font-medium uppercase tracking-[0.3em] text-ink-soft dark:text-ink-invert-soft">source_network</div>
                            <div class="rounded-lg bg-surface-soft px-3 py-2 font-mono text-[11px] text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert" id="swapField-sourceNetwork"></div>
                        </div>
                        <div class="space-y-1">
                            <div class="text-[11px] font-medium uppercase tracking-[0.3em] text-ink-soft dark:text-ink-invert-soft">source_token</div>
                            <div class="rounded-lg bg-surface-soft px-3 py-2 font-mono text-[11px] text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert" id="swapField-sourceToken"></div>
                        </div>
                        <div class="space-y-1">
                            <div class="text-[11px] font-medium uppercase tracking-[0.3em] text-ink-soft dark:text-ink-invert-soft">destination_network</div>
                            <div class="rounded-lg bg-surface-soft px-3 py-2 font-mono text-[11px] text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert" id="swapField-destNetwork"></div>
                        </div>
                        <div class="space-y-1">
                            <div class="text-[11px] font-medium uppercase tracking-[0.3em] text-ink-soft dark:text-ink-invert-soft">destination_token</div>
                            <div class="rounded-lg bg-surface-soft px-3 py-2 font-mono text-[11px] text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert" id="swapField-destToken"></div>
                        </div>
                        <div class="space-y-1 sm:col-span-2">
                            <div class="text-[11px] font-medium uppercase tracking-[0.3em] text-ink-soft dark:text-ink-invert-soft">destination_address</div>
                            <div class="break-all rounded-lg bg-surface-soft px-3 py-2 font-mono text-[11px] text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert" id="swapField-destAddress"></div>
                        </div>
                        <div class="space-y-1">
                            <div class="text-[11px] font-medium uppercase tracking-[0.3em] text-ink-soft dark:text-ink-invert-soft">refuel</div>
                            <div class="rounded-lg bg-surface-soft px-3 py-2 font-mono text-[11px] text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert" id="swapField-refuel"></div>
                        </div>
                        <div class="space-y-1">
                            <div class="text-[11px] font-medium uppercase tracking-[0.3em] text-ink-soft dark:text-ink-invert-soft">use_deposit_address</div>
                            <div class="rounded-lg bg-surface-soft px-3 py-2 font-mono text-[11px] text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert" id="swapField-useDepositAddress"></div>
                        </div>
                    </div>
                    <div class="api-hint mt-3 flex items-start gap-2 rounded-lg border border-amber-200/60 bg-amber-50 px-3 py-2 text-xs leading-relaxed text-amber-700 dark:border-amber-300/40 dark:bg-amber-300/10 dark:text-amber-200">
                        <i class="fas fa-exclamation-triangle text-sm"></i>
                        <span><strong>Important:</strong> The <code class="rounded bg-white/40 px-1 py-0.5 font-mono text-[11px] text-amber-700 dark:bg-amber-200/10 dark:text-amber-100">use_deposit_address: true</code> parameter is critical for this API flow. When set to true, the swap response will include a deposit address that users can send funds to from any supported chain.</span>
                    </div>
                </div>

                <button onclick="createSwap()" id="createSwapBtn" disabled aria-label="Create a new swap transaction" class="inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand disabled:cursor-not-allowed disabled:border-transparent disabled:bg-slate-200 disabled:text-ink-soft dark:bg-brand dark:hover:bg-brand-dark dark:focus-visible:outline-brand dark:disabled:bg-white/10 dark:disabled:text-ink-invert-soft">Create Swap</button>

                <div id="step4-result" class="result-box hidden"></div>

                <div class="hidden space-y-3" id="depositInfo">
                    <h3 class="text-sm font-semibold text-ink dark:text-ink-invert">Send <span id="depositTokenSymbol" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand"></span> to this address on <span id="depositNetworkName" class="dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand"></span></h3>
                    <div class="flex flex-wrap items-center justify-between gap-3 rounded-xl border border-slate-200/60 bg-surface-soft px-4 py-3 font-mono text-sm text-ink shadow-sm dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert">
                        <span id="depositAddress" class="break-all"></span>
                        <button class="inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand dark:focus-visible:outline-brand" onclick="copyAddress(event)">
                            <i class="fas fa-copy"></i>
                            Copy
                        </button>
                    </div>
                    <div class="api-hint flex items-start gap-2 rounded-lg border border-slate-200/60 bg-surface-soft px-3 py-2 text-xs leading-relaxed text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                        <i class="fas fa-info-circle text-sm text-brand"></i>
                        <span>This address is retrieved from the API response at: <code class="rounded bg-brand/10 px-1 py-0.5 font-mono text-[11px] text-brand">data.deposit_actions[0].to_address</code></span>
                    </div>
                </div>
            </div>

        </div>

        <!-- Step 5/6: Check Status -->
        <div class="step locked relative flex flex-col gap-8 border-b border-slate-200/60 pb-10 mb-12 scroll-mt-24 dark:border-white/10" id="step5">
            <div class="step-content flex-1 min-w-0 space-y-4">
                <span class="step-number inline-flex items-center rounded-full border border-slate-200/60 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.35em] text-brand dark:border-brand/40 dark:text-brand" id="step5-number">Step 5:</span>
                <h2 class="text-xl font-semibold text-ink dark:text-ink-invert">Check Status</h2>
                <p class="step-description text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">
                    Monitor your transaction status in real-time.
                </p>

                <button onclick="trackSwap()" id="trackBtn" disabled aria-label="Check swap transaction status" class="inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand disabled:cursor-not-allowed disabled:border-transparent disabled:bg-slate-200 disabled:text-ink-soft dark:bg-brand dark:hover:bg-brand-dark dark:focus-visible:outline-brand dark:disabled:bg-white/10 dark:disabled:text-ink-invert-soft">Check Status</button>

                <!-- Swap Route Display (shown when tracking) -->
                <div id="swapRoute" class="swap-route hidden flex flex-wrap items-center justify-center gap-3 rounded-xl border border-slate-200/60 bg-surface-soft px-4 py-3 text-xs font-semibold text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft"></div>

                <!-- Status Guide (shown after clicking Check Status) -->
                <div id="statusGuide" class="hidden mt-4 space-y-3 rounded-xl border border-slate-200/60 bg-surface-soft p-4 text-xs leading-relaxed text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                    <div class="flex flex-wrap items-baseline gap-2">
                        <span class="min-w-[150px] font-semibold uppercase tracking-[0.18em] text-ink dark:text-ink-invert">user_transfer_pending</span>
                        <span>Awaiting your deposit to the provided address.</span>
                    </div>
                    <div class="flex flex-wrap items-baseline gap-2">
                        <span class="min-w-[150px] font-semibold uppercase tracking-[0.18em] text-ink dark:text-ink-invert">ls_transfer_pending</span>
                        <span>Deposit received—Layerswap is processing your transfer.</span>
                    </div>
                    <div class="flex flex-wrap items-baseline gap-2">
                        <span class="min-w-[150px] font-semibold uppercase tracking-[0.18em] text-ink dark:text-ink-invert">completed</span>
                        <span>Transfer successfully sent to the destination account.</span>
                    </div>
                    <div class="flex flex-wrap items-baseline gap-2">
                        <span class="min-w-[150px] font-semibold uppercase tracking-[0.18em] text-ink dark:text-ink-invert">failed</span>
                        <span>The transfer could not be completed. Contact support.</span>
                    </div>
                </div>

                <div id="step5-result" class="result-box hidden"></div>

                <div class="hidden" id="swapTransactions">
                    <h4 class="text-sm font-semibold text-ink dark:text-ink-invert">Transactions</h4>
                    <div id="swapInputs"></div>
                    <div id="swapOutputs"></div>
                </div>
            </div>

        </div>

        <!-- Contact Section -->
        <div class="mt-12 rounded-2xl border border-slate-200/60 bg-white/90 p-6 text-center shadow-sm dark:border-white/10 dark:bg-surface-dark/80">
            <h3 class="text-lg font-semibold text-ink dark:text-ink-invert">Need Help with Integration?</h3>
            <p class="mt-2 text-sm leading-relaxed text-ink-soft dark:text-ink-invert-soft">For partnership inquiries and integration support, our team is here to help.</p>
            <div class="mt-4 flex flex-wrap items-center justify-center gap-4">
                <a href="mailto:partners@layerswap.io" class="inline-flex items-center gap-2 rounded-lg bg-brand px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand">
                    <i class="fas fa-envelope text-base"></i>
                    partners@layerswap.io
                </a>
                <a href="https://t.me/layerswap_dev" target="_blank" rel="noreferrer" class="inline-flex items-center gap-2 rounded-lg bg-[linear-gradient(135deg,#2AABEE_0%,#229ED9_100%)] px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:brightness-[1.05] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#229ED9]">
                    <i class="fab fa-telegram text-base text-white"></i>
                    Join Dev Community
                </a>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-12 border-t border-slate-200/60 pt-6 dark:border-white/10">
            <div class="flex flex-col items-center gap-4">
                <div class="flex flex-wrap justify-center gap-5 text-xs font-medium text-ink-soft dark:text-ink-invert-soft">
                    <a href="https://www.layerswap.io" target="_blank" rel="noreferrer" class="inline-flex items-center gap-2 transition hover:text-brand">
                        <i class="fas fa-home text-sm"></i>
                        Layerswap
                    </a>
                    <a href="https://docs.layerswap.io" target="_blank" rel="noreferrer" class="inline-flex items-center gap-2 transition hover:text-brand">
                        <i class="fas fa-book text-sm"></i>
                        Documentation
                    </a>
                    <a href="https://x.com/layerswap" target="_blank" rel="noreferrer" class="inline-flex items-center gap-2 transition hover:text-brand">
                        <i class="fab fa-x-twitter text-sm"></i>
                        X
                    </a>
                    <a href="https://discord.com/invite/layerswap" target="_blank" rel="noreferrer" class="inline-flex items-center gap-2 transition hover:text-brand">
                        <i class="fab fa-discord text-sm"></i>
                        Discord
                    </a>
                    <a href="https://github.com/layerswap" target="_blank" rel="noreferrer" class="inline-flex items-center gap-2 transition hover:text-brand">
                        <i class="fab fa-github text-sm"></i>
                        GitHub
                    </a>
                </div>
                <p class="text-xs text-ink-soft/80 dark:text-ink-invert-soft">
                    © <span id="copyright-year"></span> Layerswap Labs, Inc.
                </p>
            </div>
        </footer>
    </div>

    <!-- Right API Sidebar -->
    <aside class="api-sidebar mt-0 lg:mt-0 flex w-full flex-col gap-6 border-t border-slate-200/60 pt-6 dark:border-white/10 lg:w-[26rem] lg:border-t-0 lg:border-l lg:pt-0 lg:pl-6 lg:sticky lg:top-[4rem] lg:max-h-[calc(100vh-4rem)] lg:overflow-y-auto lg:shrink-0">
        <div class="api-cards-container flex flex-col gap-4" id="api-cards-container">
            <div id="api-empty-state" class="flex flex-col items-center justify-center rounded-2xl border border-slate-200/60 bg-white/80 px-5 py-8 text-center text-sm text-ink-soft shadow-sm dark:border-white/10 dark:bg-surface-dark/80 dark:text-ink-invert-soft">
                <i class="fa-solid fa-code-branch text-lg text-brand/70"></i>
                <p class="mt-3 text-sm leading-relaxed">Run an API step to see live requests and responses here.</p>
            </div>
            <!-- Step 1 doesn't have API calls -->
            <div class="api-step-section hidden flex flex-col gap-3" data-step="1">
            </div>

            <!-- Step 2 API cards -->
            <div class="api-step-section hidden flex flex-col gap-3" data-step="2">
                <div class="api-card api-request-card request-details hidden overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step2-request-details">
                    <div class="flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Request</span>
                        <div class="flex items-center gap-2">
                            <button class="request-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyRequestCode('step2', 'curl', event)">
                                <i class="fas fa-copy text-[12px]"></i>
                                Copy
                            </button>
                            <a href="https://docs.layerswap.io/api-reference/swaps/get-sources" target="_blank" class="api-docs-link inline-flex items-center gap-2 text-xs font-medium text-ink-soft transition hover:text-brand dark:text-ink-invert-soft dark:hover:text-brand" title="View API Reference">
                                <i class="fas fa-external-link-alt text-[13px]"></i>
                                API Docs
                            </a>
                        </div>
                    </div>
                    <div class="request-info flex flex-col gap-2 border-b border-slate-200/60 bg-surface-soft px-5 py-4 text-xs text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Method:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert">GET</span>
                        </div>
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Endpoint:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert break-all">/api/v2/sources</span>
                        </div>
                    </div>
                    <div class="request-content hidden max-h-[220px] overflow-y-auto overflow-x-auto bg-surface px-5 py-4 font-mono text-[11px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step2-request-content">
                        <pre class="plain-curl hidden"></pre>
                        <pre class="m-0 overflow-visible whitespace-pre-wrap leading-relaxed"><span id="step2-request-curl"></span></pre>
                    </div>
                </div>
                <div class="api-card api-response-card json-response hidden max-h-[420px] min-h-0 flex flex-col overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step2-response-card">
                    <div class="api-card-header flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Response</span>
                        <button class="json-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyApiJson('step2', event)">
                            <i class="fas fa-copy text-[12px]"></i>
                            Copy
                        </button>
                    </div>
                    <div class="json-content flex-1 overflow-y-auto bg-surface px-5 py-4 text-[12px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step2-json-content">
                        <div class="font-mono" id="step2-json-data"></div>
                    </div>
                </div>
            </div>

            <!-- Step 3 Destination API cards (Multiple Tokens Mode) -->
            <div class="api-step-section hidden flex flex-col gap-3" data-step="3-destination">
                <div class="api-card api-request-card request-details hidden overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step3-destination-request-details">
                    <div class="flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Request</span>
                        <div class="flex items-center gap-2">
                            <button class="request-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyRequestCode('step3-destination', 'curl', event)">
                                <i class="fas fa-copy text-[12px]"></i>
                                Copy
                            </button>
                            <a href="https://docs.layerswap.io/api-reference/swaps/get-destinations" target="_blank" class="api-docs-link inline-flex items-center gap-2 text-xs font-medium text-ink-soft transition hover:text-brand dark:text-ink-invert-soft dark:hover:text-brand" title="View API Reference">
                                <i class="fas fa-external-link-alt text-[13px]"></i>
                                API Docs
                            </a>
                        </div>
                    </div>
                    <div class="request-info flex flex-col gap-2 border-b border-slate-200/60 bg-surface-soft px-5 py-4 text-xs text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Method:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert">GET</span>
                        </div>
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Endpoint:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert break-all">/api/v2/destinations</span>
                        </div>
                    </div>
                    <div class="request-content hidden max-h-[220px] overflow-y-auto overflow-x-auto bg-surface px-5 py-4 font-mono text-[11px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step3-destination-request-content">
                        <pre class="plain-curl hidden"></pre>
                        <pre class="m-0 overflow-visible whitespace-pre-wrap leading-relaxed"><span id="step3-destination-request-curl"></span></pre>
                    </div>
                </div>
                <div class="api-card api-response-card json-response hidden max-h-[420px] min-h-0 flex flex-col overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step3-destination-response-card">
                    <div class="api-card-header flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Response</span>
                        <button class="json-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyApiJson('step3-destination', event)">
                            <i class="fas fa-copy text-[12px]"></i>
                            Copy
                        </button>
                    </div>
                    <div class="json-content flex-1 overflow-y-auto bg-surface px-5 py-4 text-[12px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step3-destination-json-content">
                        <div class="font-mono" id="step3-destination-json-data"></div>
                    </div>
                </div>
            </div>

            <!-- Step 3 API cards -->
            <div class="api-step-section hidden flex flex-col gap-3" data-step="3">
                <div class="api-card api-request-card request-details hidden overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step3-request-details">
                    <div class="flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Request</span>
                        <div class="flex items-center gap-2">
                            <button class="request-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyRequestCode('step3', 'curl', event)">
                                <i class="fas fa-copy text-[12px]"></i>
                                Copy
                            </button>
                            <a href="https://docs.layerswap.io/api-reference/swaps/get-detailed-quote" target="_blank" class="api-docs-link inline-flex items-center gap-2 text-xs font-medium text-ink-soft transition hover:text-brand dark:text-ink-invert-soft dark:hover:text-brand" title="View API Reference">
                                <i class="fas fa-external-link-alt text-[13px]"></i>
                                API Docs
                            </a>
                        </div>
                    </div>
                    <div class="request-info flex flex-col gap-2 border-b border-slate-200/60 bg-surface-soft px-5 py-4 text-xs text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Method:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert">GET</span>
                        </div>
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Endpoint:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert break-all">/api/v2/detailed_quote</span>
                        </div>
                    </div>
                    <div class="request-content hidden max-h-[220px] overflow-y-auto overflow-x-auto bg-surface px-5 py-4 font-mono text-[11px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step3-request-content">
                        <pre class="plain-curl hidden"></pre>
                        <pre class="m-0 overflow-visible whitespace-pre-wrap leading-relaxed"><span id="step3-request-curl"></span></pre>
                    </div>
                </div>
                <div class="api-card api-response-card json-response hidden max-h-[420px] min-h-0 flex flex-col overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step3-response-card">
                    <div class="api-card-header flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Response</span>
                        <button class="json-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyApiJson('step3', event)">
                            <i class="fas fa-copy text-[12px]"></i>
                            Copy
                        </button>
                    </div>
                    <div class="json-content flex-1 overflow-y-auto bg-surface px-5 py-4 text-[12px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step3-json-content">
                        <div class="font-mono" id="step3-json-data"></div>
                    </div>
                </div>
            </div>

            <!-- Step 4 API cards -->
            <div class="api-step-section hidden flex flex-col gap-3" data-step="4">
                <div class="api-card api-request-card request-details hidden overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step4-request-details">
                    <div class="flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Request</span>
                        <div class="flex items-center gap-2">
                            <button class="request-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyRequestCode('step4', 'curl', event)">
                                <i class="fas fa-copy text-[12px]"></i>
                                Copy
                            </button>
                            <a href="https://docs.layerswap.io/api-reference/swaps/create-swap" target="_blank" class="api-docs-link inline-flex items-center gap-2 text-xs font-medium text-ink-soft transition hover:text-brand dark:text-ink-invert-soft dark:hover:text-brand" title="View API Reference">
                                <i class="fas fa-external-link-alt text-[13px]"></i>
                                API Docs
                            </a>
                        </div>
                    </div>
                    <div class="request-info flex flex-col gap-2 border-b border-slate-200/60 bg-surface-soft px-5 py-4 text-xs text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Method:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert">POST</span>
                        </div>
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Endpoint:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert break-all">/api/v2/swaps</span>
                        </div>
                    </div>
                    <div class="request-content hidden max-h-[220px] overflow-y-auto overflow-x-auto bg-surface px-5 py-4 font-mono text-[11px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step4-request-content">
                        <pre class="plain-curl hidden"></pre>
                        <pre class="m-0 overflow-visible whitespace-pre-wrap leading-relaxed"><span id="step4-request-curl"></span></pre>
                    </div>
                </div>
                <div class="api-card api-response-card json-response hidden max-h-[420px] min-h-0 flex flex-col overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step4-response-card">
                    <div class="api-card-header flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Response</span>
                        <button class="json-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyApiJson('step4', event)">
                            <i class="fas fa-copy text-[12px]"></i>
                            Copy
                        </button>
                    </div>
                    <div class="json-content flex-1 overflow-y-auto bg-surface px-5 py-4 text-[12px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step4-json-content">
                        <div class="font-mono" id="step4-json-data"></div>
                    </div>
                </div>
            </div>

            <!-- Step 5 API cards -->
            <div class="api-step-section hidden flex flex-col gap-3" data-step="5">
                <div class="api-card api-request-card request-details hidden overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step5-request-details">
                    <div class="flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Request</span>
                        <div class="flex items-center gap-2">
                            <button class="request-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyRequestCode('step5', 'curl', event)">
                                <i class="fas fa-copy text-[12px]"></i>
                                Copy
                            </button>
                            <a href="https://docs.layerswap.io/api-reference/swaps/get-swap-details" target="_blank" class="api-docs-link inline-flex items-center gap-2 text-xs font-medium text-ink-soft transition hover:text-brand dark:text-ink-invert-soft dark:hover:text-brand" title="View API Reference">
                                <i class="fas fa-external-link-alt text-[13px]"></i>
                                API Docs
                            </a>
                        </div>
                    </div>
                    <div class="request-info flex flex-col gap-2 border-b border-slate-200/60 bg-surface-soft px-5 py-4 text-xs text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Method:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert">GET</span>
                        </div>
                        <div class="request-info-item flex items-baseline gap-2">
                            <span class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Endpoint:</span>
                            <span class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert break-all">/api/v2/swaps/{swapId}</span>
                        </div>
                    </div>
                    <div class="request-content hidden max-h-[220px] overflow-y-auto overflow-x-auto bg-surface px-5 py-4 font-mono text-[11px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step5-request-content">
                        <pre class="plain-curl hidden"></pre>
                        <pre class="m-0 overflow-visible whitespace-pre-wrap leading-relaxed"><span id="step5-request-curl"></span></pre>
                    </div>
                </div>
                <div class="api-card api-response-card json-response hidden max-h-[420px] min-h-0 flex flex-col overflow-hidden rounded-2xl border border-slate-200/60 bg-surface shadow-sm dark:border-white/10 dark:bg-surface-dark/80" id="step5-response-card">
                    <div class="api-card-header flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                        <span>API Response</span>
                        <button class="json-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyApiJson('step5', event)">
                            <i class="fas fa-copy text-[12px]"></i>
                            Copy
                        </button>
                    </div>
                    <div class="json-content flex-1 overflow-y-auto bg-surface px-5 py-4 text-[12px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft" id="step5-json-content">
                        <div class="font-mono" id="step5-json-data"></div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    </div> <!-- End layout wrapper -->

    <!-- JSON Formatter Library -->
    <!-- External Dependencies with Security Headers -->
    <link rel="stylesheet"
          href="https://unpkg.com/json-formatter-js@2.3.4/dist/json-formatter.css"
          crossorigin="anonymous">
    <script src="https://unpkg.com/json-formatter-js@2.3.4/dist/json-formatter.umd.js"
            crossorigin="anonymous"
            defer></script>

    <script>
        // === THEME TOGGLE ===
        const THEME_MESSAGE_TYPE = 'DEPOSIT_WIDGET_THEME';
        const THEME_REQUEST_MESSAGE_TYPE = 'DEPOSIT_WIDGET_THEME_REQUEST';
        const isInIframe = window.self !== window.top;
        const html = document.documentElement;
        const body = document.body;

        function setTheme(theme, { persist = true } = {}) {
            if (theme !== 'dark' && theme !== 'light') return;

            [html, body].forEach((el) => {
                if (!el) return;
                el.setAttribute('data-theme', theme);
                el.classList.toggle('dark', theme === 'dark');
                el.classList.toggle('light', theme === 'light');
            });

            if (persist) {
                localStorage.setItem('theme', theme);
            }
        }

        // Initialize theme on page load
        (function() {
            // Check if user has a saved preference, otherwise use system preference
            const savedTheme = localStorage.getItem('theme');
            const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const theme = savedTheme || systemTheme;

            setTheme(theme, { persist: !isInIframe && Boolean(savedTheme) });

            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                // Only update if user hasn't manually set a preference
                if (!localStorage.getItem('theme') || isInIframe) {
                    const newTheme = e.matches ? 'dark' : 'light';
                    setTheme(newTheme, { persist: !isInIframe });
                }
            });
        })();

        if (isInIframe) {
            const inferThemeFromElement = (element) => {
                if (!element) return undefined;

                const attrCandidates = [
                    element.getAttribute?.('data-theme'),
                    element.getAttribute?.('data-mode'),
                    element.getAttribute?.('data-color-mode'),
                    element.getAttribute?.('data-color-theme'),
                    element.getAttribute?.('data-appearance'),
                    element.getAttribute?.('data-color-scheme'),
                    element.dataset?.theme,
                    element.dataset?.mode,
                    element.dataset?.colorMode,
                    element.dataset?.colorTheme,
                    element.dataset?.appearance,
                    element.dataset?.colorScheme,
                ];

                for (const value of attrCandidates) {
                    if (!value) continue;
                    const lowered = value.toLowerCase();
                    if (lowered.includes('dark')) return 'dark';
                    if (lowered.includes('light')) return 'light';
                }

                const className = typeof element.className === 'string' ? element.className : '';
                if (className && className.includes('dark') && !className.includes('light')) return 'dark';
                if (className && className.includes('light') && !className.includes('dark')) return 'light';

                try {
                    const style = element.ownerDocument?.defaultView?.getComputedStyle(element);
                    const colorScheme = style?.getPropertyValue?.('color-scheme');
                    if (colorScheme) {
                        if (colorScheme.includes('dark')) return 'dark';
                        if (colorScheme.includes('light')) return 'light';
                    }

                    const bg = style?.getPropertyValue?.('background-color');
                    if (bg) {
                        const rgb = bg.match(/\d+\.?\d*/g)?.map(Number);
                        if (rgb && rgb.length >= 3) {
                            const [r, g, b] = rgb;
                            const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;
                            if (luminance < 90) return 'dark';
                            if (luminance > 200) return 'light';
                        }
                    }
                } catch (err) {
                    // Ignore style access errors
                }

                return undefined;
            };

            const resolveThemeFromParent = () => {
                try {
                    const parentDoc = window.parent?.document;
                    if (!parentDoc) return undefined;
                    const candidates = [parentDoc.documentElement, parentDoc.body];
                    const selectors = ['[data-theme]', '[data-mode]', '[data-color-mode]', '[data-color-theme]', '[data-appearance]', '[data-color-scheme]'];
                    selectors.forEach((selector) => {
                        parentDoc.querySelectorAll(selector).forEach((el) => candidates.push(el));
                    });
                    for (const node of candidates) {
                        const theme = inferThemeFromElement(node);
                        if (theme) return theme;
                    }
                } catch (err) {
                    // Cross-origin or inaccessible parent
                }
                return undefined;
            };

            const applyParentTheme = () => {
                const parentTheme = resolveThemeFromParent();
                if (parentTheme === 'dark' || parentTheme === 'light') {
                    setTheme(parentTheme, { persist: false });
                }
            };

            // Apply immediately and on interval to guard against missed mutations
            applyParentTheme();
            const syncInterval = window.setInterval(applyParentTheme, 500);

            let parentObserver;
            try {
                const parentDoc = window.parent?.document;
                const ParentMutationObserver = window.MutationObserver || window.WebKitMutationObserver;
                if (parentDoc && ParentMutationObserver) {
                    parentObserver = new ParentMutationObserver(applyParentTheme);
                    [parentDoc.documentElement, parentDoc.body]
                        .filter(Boolean)
                        .forEach((node) => {
                            parentObserver.observe(node, {
                                attributes: true,
                                attributeFilter: ['data-theme', 'data-mode', 'data-color-mode', 'data-color-theme', 'data-appearance', 'data-color-scheme', 'class'],
                            });
                        });
                }
            } catch (err) {
                // Ignore observer errors
            }

            window.addEventListener('message', (event) => {
                const data = event?.data;
                if (!data || typeof data !== 'object') return;
                if (data.type !== THEME_MESSAGE_TYPE) return;

                const { theme } = data;
                if (theme === 'dark' || theme === 'light') {
                    setTheme(theme, { persist: false });
                }
            });

            // Request initial theme from parent
            try {
                window.parent?.postMessage?.({ type: THEME_REQUEST_MESSAGE_TYPE }, '*');
            } catch (err) {
                // Ignore messaging errors
            }

            window.addEventListener('pagehide', () => {
                window.clearInterval(syncInterval);
                parentObserver?.disconnect?.();
            });
        }

        // Constants
        const API_BASE = 'https://api.layerswap.io/api/v2';
        const POLL_INTERVAL_MS = 5000; // 5 seconds
        const COPY_FEEDBACK_DURATION_MS = 1000; // 1 second
        const LOADING_INDICATOR_HIDE_DELAY_MS = 500; // 0.5 seconds
        const API_TIMEOUT_MS = 30000; // 30 seconds
        const MS_PER_SECOND = 1000;

        // Production configuration - Replace with environment variables in production
        const PRODUCTION = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
        // Demo API key - Replace with your actual API key in production
        const API_KEY_PLACEHOLDER = 'YOUR_API_KEY_HERE';

        // Error logging for production
        function logError(error, context = '') {
            if (!PRODUCTION) {
                // In development, log to console
                console.error(`[${context}]`, error);
            } else {
                // In production, send to error tracking service
                // Example: Sentry, LogRocket, or custom endpoint
                // window.Sentry?.captureException(error, { extra: { context } });

                // For now, silently handle errors in production
                // You should integrate with a real error tracking service
            }
        }

        // Production-safe console wrapper
        const safeConsole = {
            log: (...args) => !PRODUCTION && console.log(...args),
            warn: (...args) => !PRODUCTION && console.warn(...args),
            error: (...args) => !PRODUCTION && console.error(...args),
        };

        // Utility functions
        // Debounce function to limit how often a function can fire
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Throttle function for scroll and resize events
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // HTML sanitization utility to prevent XSS
        function escapeHtml(text) {
            if (text == null) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;',
                '/': '&#x2F;'
            };
            return String(text).replace(/[&<>"'\/]/g, m => map[m]);
        }

        // Sanitize user input values
        function sanitizeInput(value) {
            if (value == null) return '';
            // Remove any script tags and dangerous characters
            return String(value)
                .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                .replace(/javascript:/gi, '')
                .replace(/on\w+\s*=/gi, '')
                .trim();
        }

        // Single source of truth for API documentation URLs
        const API_DOCS_URLS = {
            'step2': 'https://docs.layerswap.io/api-reference/swaps/get-sources',
            'step2-destination': 'https://docs.layerswap.io/api-reference/swaps/get-destinations',
            'step3': 'https://docs.layerswap.io/api-reference/swaps/get-detailed-quote',
            'step4': 'https://docs.layerswap.io/api-reference/swaps/create-swap',
            'step5': 'https://docs.layerswap.io/api-reference/swaps/get-swap-details'
        };

        let config = {
            apiKey: '2XB8/E0WYmRZkwxJSB06nqL3DKy6IdlpJQr2vb6JsE8M55Dl5DmaMWMNJCzRm5bX8p/mBBn1moR+EdEzAMtb/g', // Default API key
            walletAddress: '',
            destinationNetwork: 'BASE_MAINNET', // Default to Base
            destinationToken: 'ETH' // Optional - defaults to ETH
        };

        let state = {
            networkMap: {},  // Cache network data
            sourceNetwork: '',
            sourceToken: '',
            destinationTokenMultiple: '', // For multiple tokens mode
            maxAmount: null,  // Max amount from quote
            swapId: null,
            tokenMode: 'single', // 'single' or 'multiple'
            trackingInterval: null
        };

        // Store JSON responses for copying
        let jsonResponses = {};

        const DROPDOWN_ACTIVE_CLASSES = ['ring-2', 'ring-brand', 'ring-offset-0', 'shadow-lg', 'dark:ring-brand'];
        const NETWORK_BASE_CLASSES = 'network-item flex items-center gap-3 rounded-lg border border-transparent px-4 py-2 text-sm text-ink transition hover:bg-surface-highlight dark:text-ink-invert dark:hover:bg-surface-dark-muted';
        const NETWORK_SELECTED_CLASSES = ['bg-brand/10', 'border', 'border-brand/40', 'text-brand', 'dark:bg-brand/20', 'dark:border-brand/50', 'dark:text-brand'];
        const TOKEN_BASE_CLASSES = 'token-item flex items-center gap-3 rounded-lg px-4 py-2 text-sm text-ink transition hover:bg-surface-highlight dark:text-ink-invert dark:hover:bg-surface-dark-muted';
        const TOKEN_SELECTED_CLASSES = ['bg-brand/10', 'text-brand', 'dark:bg-brand/20', 'dark:text-brand'];
        const SOURCE_CARD_BASE_CLASSES = 'source-card flex flex-col items-start justify-center gap-1.5 rounded-xl border border-slate-200/70 bg-white/95 px-4 py-4 text-left text-sm font-medium text-ink shadow-sm transition hover:border-brand hover:bg-brand/5 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand dark:border-white/10 dark:bg-surface-dark/70 dark:text-ink-invert dark:hover:border-brand dark:hover:bg-brand/10 dark:focus-visible:outline-brand';
        const SOURCE_CARD_SELECTED_CLASSES = ['border-brand', 'bg-brand/10', 'text-brand', 'shadow-lg', 'ring-2', 'ring-brand/30', 'ring-offset-1', 'ring-offset-white', 'dark:border-brand/60', 'dark:bg-brand/20', 'dark:text-brand', 'dark:ring-brand/50', 'dark:ring-offset-0'];
        const TOKEN_GRID_CARD_BASE_CLASSES = 'token-card flex flex-col items-center justify-center gap-2 rounded-xl border border-slate-200/70 bg-white/95 px-4 py-3 text-center text-sm font-semibold text-ink shadow-sm transition hover:border-brand hover:bg-brand/5 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand dark:border-white/10 dark:bg-surface-dark/70 dark:text-ink-invert dark:hover:border-brand dark:hover:bg-brand/10 dark:focus-visible:outline-brand';
        const TOKEN_GRID_SELECTED_CLASSES = ['border-brand', 'bg-brand/15', 'text-brand', 'shadow-md', 'ring-2', 'ring-brand/30', 'dark:border-brand/50', 'dark:bg-brand/25', 'dark:text-brand', 'dark:ring-brand/50'];
        const RESULT_BASE_CLASSES = 'result-box mt-4 rounded-xl border border-slate-200/70 bg-white/90 px-4 py-3 text-sm leading-relaxed text-ink-soft shadow-sm dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft';
        const RESULT_SUCCESS_CLASSES = ['border-emerald-400/60', 'bg-emerald-50', 'text-emerald-700', 'dark:border-emerald-400/40', 'dark:bg-emerald-400/20', 'dark:text-emerald-200'];
        const RESULT_ERROR_CLASSES = ['border-rose-400/60', 'bg-rose-50', 'text-rose-700', 'dark:border-rose-400/40', 'dark:bg-rose-400/20', 'dark:text-rose-200'];
        const DYNAMIC_BADGE_CLASSES = 'dynamic-value inline-flex items-center gap-1 rounded-lg border border-brand/20 bg-brand/10 px-2.5 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-brand dark:border-brand/40 dark:bg-brand/20 dark:text-brand';

        function showResult(resultBox, message, { variant = 'neutral', html = false } = {}) {
            if (!resultBox) return;
            resultBox.className = RESULT_BASE_CLASSES;
            resultBox.classList.remove('hidden');
            if (html) {
                resultBox.innerHTML = message;
            } else {
                resultBox.textContent = message;
            }

            if (variant === 'success') {
                addClasses(resultBox, RESULT_SUCCESS_CLASSES);
            } else if (variant === 'error') {
                addClasses(resultBox, RESULT_ERROR_CLASSES);
            }
        }

        function addClasses(element, classes) {
            if (!element) return;
            classes.forEach(cls => element.classList.add(cls));
        }

        function removeClasses(element, classes) {
            if (!element) return;
            classes.forEach(cls => element.classList.remove(cls));
        }

        // Keep reference to current scroll spy listeners so we can clean them up on mode changes
        let scrollSpyCleanup = null;

        // Helper function to format numbers without scientific notation
        function formatAmount(amount) {
            if (!amount || amount === 'N/A') return 'N/A';
            const num = parseFloat(amount);
            if (isNaN(num)) return amount;

            // For very small numbers, show up to 8 decimal places
            if (num < 0.00001) {
                return num.toFixed(8).replace(/\.?0+$/, '');
            }
            // For normal numbers, show up to 6 decimal places
            return num.toFixed(6).replace(/\.?0+$/, '');
        }

        // Input validation functions
        function validateApiKey(apiKey) {
            // API key is optional
            if (!apiKey || apiKey.trim().length === 0) {
                return { valid: true, warning: 'No API key provided. Using default rate limits.' };
            }
            // If provided, basic validation - API keys should be at least 20 characters
            if (apiKey.trim().length < 20) {
                return { valid: false, error: 'API key appears to be invalid (too short)' };
            }
            return { valid: true };
        }

        function validateWalletAddress(address) {
            // Only check if address is provided, no format validation
            if (!address || address.trim().length === 0) {
                return { valid: false, error: 'Wallet address is required' };
            }
            return { valid: true };
        }

        function validateAmount(amount, maxAmount = null) {
            const numAmount = parseFloat(amount);

            if (isNaN(numAmount)) {
                return { valid: false, error: 'Amount must be a valid number' };
            }

            if (numAmount <= 0) {
                return { valid: false, error: 'Amount must be greater than zero' };
            }

            if (maxAmount !== null && numAmount > parseFloat(maxAmount)) {
                return { valid: false, error: `Amount cannot exceed maximum of ${formatAmount(maxAmount)}` };
            }

            return { valid: true };
        }

        function showValidationError(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                const existingError = element.parentElement.querySelector('.validation-error');
                if (existingError) {
                    existingError.remove();
                }

                const errorDiv = document.createElement('div');
                errorDiv.className = 'validation-error';
                errorDiv.style.cssText = 'color: var(--error-text); font-size: 12px; margin-top: 4px;';
                errorDiv.textContent = message;
                element.parentElement.appendChild(errorDiv);
            }
        }

        function clearValidationError(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                const existingError = element.parentElement.querySelector('.validation-error');
                if (existingError) {
                    existingError.remove();
                }
            }
        }

        // Auto-update config when fields change
        function updateConfig() {
            // Sanitize all user inputs to prevent XSS
            config.apiKey = sanitizeInput(document.getElementById('apiKey').value.trim());
            config.walletAddress = sanitizeInput(document.getElementById('walletAddress').value.trim());
            config.destinationNetwork = sanitizeInput(document.getElementById('destinationNetwork').value);

            // Only set destination token in single token mode
            if (state.tokenMode === 'single') {
                config.destinationToken = sanitizeInput(document.getElementById('destinationToken').value);
            }

            // Validate inputs
            const apiKeyValidation = validateApiKey(config.apiKey);
            const walletValidation = validateWalletAddress(config.walletAddress);

            // Show or clear validation errors/warnings
            if (!apiKeyValidation.valid) {
                showValidationError('apiKey', apiKeyValidation.error);
            } else if (apiKeyValidation.warning) {
                // Show a subtle warning for missing API key (optional)
                clearValidationError('apiKey');
                // Optionally show a subtle info message - commenting out for cleaner UI
                // showValidationInfo('apiKey', apiKeyValidation.warning);
            } else {
                clearValidationError('apiKey');
            }

            if (config.walletAddress && !walletValidation.valid) {
                showValidationError('walletAddress', walletValidation.error);
            } else {
                clearValidationError('walletAddress');
            }

            // Enable Step 1 if all required fields are filled and valid
            const isValid = state.tokenMode === 'single'
                ? apiKeyValidation.valid && walletValidation.valid && config.destinationNetwork && config.destinationToken
                : apiKeyValidation.valid && walletValidation.valid && config.destinationNetwork;

            if (isValid) {
                document.getElementById('step2').classList.remove('locked');
                document.getElementById('getSourcesBtn').disabled = false;
                unlockNavItem('step2');

                // Update destination network display
                const networkSelect = document.getElementById('destinationNetwork');
                const selectedOption = networkSelect.options[networkSelect.selectedIndex];
                // In single token mode, show the token as well
                if (state.tokenMode === 'single' && config.destinationToken) {
                    document.getElementById('destinationNetworkDisplay').textContent = `${config.destinationToken} on ${selectedOption.text}`;
                } else {
                    document.getElementById('destinationNetworkDisplay').textContent = selectedOption.text;
                }

                // Also update for multiple tokens mode
                document.getElementById('destNetworkForTokens').textContent = selectedOption.text;
            } else {
                document.getElementById('step2').classList.add('locked');
                document.getElementById('getSourcesBtn').disabled = true;
            }

            // Update swap request fields if they're visible
            const swapRequestFields = document.getElementById('swapRequestFields');
            if (swapRequestFields && !swapRequestFields.classList.contains('hidden')) {
                document.getElementById('swapField-destNetwork').textContent = config.destinationNetwork;
                const destToken = state.tokenMode === 'single' ? config.destinationToken : state.destinationTokenMultiple;
                document.getElementById('swapField-destToken').textContent = destToken;
                document.getElementById('swapField-destAddress').textContent = config.walletAddress;
            }
        }

        // Set up event listeners when page loads
        window.addEventListener('DOMContentLoaded', async () => {
            // Fetch and populate destinations (networks and tokens)
            const destinations = await fetchDestinations();
            populateDestinationNetworks(destinations);

            // Set up event listeners with debouncing for better performance
            const debouncedUpdateConfig = debounce(updateConfig, 300);
            document.getElementById('apiKey').addEventListener('input', debouncedUpdateConfig);
            document.getElementById('walletAddress').addEventListener('input', debouncedUpdateConfig);

            // Add event handler for network changes to update token options
            document.getElementById('destinationNetwork').addEventListener('change', () => {
                populateDestinationTokens();
                updateConfig();
            });

            document.getElementById('destinationToken').addEventListener('change', updateConfig);

            // Initial update
            updateConfig();

            // Setup scroll spy for navigation
            setupScrollSpy();

            // Set copyright year dynamically
            document.getElementById('copyright-year').textContent = new Date().getFullYear();
        });

        // === NAVIGATION SCROLL SPY ===
        function setupScrollSpy() {
            // Remove previous listeners if scroll spy was initialized before
            if (typeof scrollSpyCleanup === 'function') {
                scrollSpyCleanup();
                scrollSpyCleanup = null;
            }

            const sections = state.tokenMode === 'multiple'
                ? ['overview', 'step1', 'step2', 'step3-destination', 'step3', 'step4', 'step5']
                : ['overview', 'step1', 'step2', 'step3', 'step4', 'step5'];
            const navLinks = Array.from(document.querySelectorAll('.nav-link'));
            let isUserScrolling = true;

            // Function to update active nav based on scroll position
            function updateActiveNav() {
                if (!isUserScrolling) return;

                const offset = Math.max(window.innerHeight * 0.25, 180);
                const scrollPosition = window.scrollY + offset;

                let currentSection = sections[0] || '';

                // Find which section we're currently in
                sections.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && element.offsetParent !== null) {
                        const offsetTop = element.offsetTop;
                        const offsetHeight = element.offsetHeight;

                        if (scrollPosition >= offsetTop) {
                            currentSection = id;
                        }
                    }
                });

                // Update active state
                if (currentSection) {
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${currentSection}`) {
                            link.classList.add('active');
                        }
                    });

                    // Update API sidebar for current step
                    updateApiSidebarForStep(currentSection);
                }
            }

            // Optimize scroll events with throttling for better performance
            const throttledUpdateNav = throttle(updateActiveNav, 100);
            window.addEventListener('scroll', throttledUpdateNav);

            // Handle click navigation
            const clickHandlers = new Map();
            navLinks.forEach(link => {
                const handler = (e) => {
                    if (link.classList.contains('locked')) {
                        e.preventDefault();
                        return;
                    }

                    // Manually update active state on click
                    isUserScrolling = false;
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');

                    // Update API sidebar for clicked step
                    const stepId = link.getAttribute('href').substring(1);
                    updateApiSidebarForStep(stepId);

                    // Re-enable scroll spy after a short delay
                    setTimeout(() => {
                        isUserScrolling = true;
                    }, 1000);

                    // Let default anchor behavior handle scroll
                };
                clickHandlers.set(link, handler);
                link.addEventListener('click', handler);
            });

            // Initial update
            updateActiveNav();

            // Initialize API sidebar for step 1
            updateApiSidebarForStep('step1');

            // Store cleanup function so we can detach listeners on the next setup
            scrollSpyCleanup = () => {
                window.removeEventListener('scroll', throttledUpdateNav);
                clickHandlers.forEach((handler, link) => link.removeEventListener('click', handler));
            };
        }

        // Helper function to unlock navigation items
        function unlockNavItem(stepId) {
            const navLink = document.getElementById(`nav-${stepId}`);
            if (navLink) {
                navLink.classList.remove('locked');
            }
        }

        function displayJsonResponse(step, data, isForSidebar = false) {
            const jsonData = document.getElementById(`${step}-json-data`);
            if (!jsonData) return;

            // Store JSON data for copying
            jsonResponses[step] = data;

            // Clear previous content
            jsonData.innerHTML = '';

            try {
                // Create JSON formatter with 3 levels open by default
                const formatter = new JSONFormatter(data, 3, {
                    theme: 'dark',
                    animateOpen: false,
                    animateClose: false
                });

                jsonData.appendChild(formatter.render());
            } catch (error) {
                // Fallback to simple pre formatting
                const pre = document.createElement('pre');
                pre.style.color = '#d4d4d4';
                pre.style.fontSize = '12px';
                pre.style.lineHeight = '1.6';
                pre.style.margin = '0';
                pre.style.whiteSpace = 'pre-wrap';
                pre.style.wordBreak = 'break-all';
                pre.textContent = JSON.stringify(data, null, 2);
                jsonData.appendChild(pre);
            }

            if (!isForSidebar) {
                const jsonContainer = document.getElementById(`${step}-json`);
                if (jsonContainer) {
                    jsonContainer.classList.remove('hidden');
                }
            }
        }

        // Universal copy function
        function copyToClipboard(content, event) {
            const btn = event.currentTarget;
            const originalHTML = btn.innerHTML;

            navigator.clipboard.writeText(content).then(() => {
                // Show success feedback
                btn.innerHTML = `
                    <i class="fas fa-check"></i>
                    Copied!
                `;
                btn.style.background = 'var(--success-bg)';
                btn.style.borderColor = 'var(--success-border)';
                btn.style.color = 'var(--success-text)';

                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.style.background = '';
                    btn.style.borderColor = '';
                    btn.style.color = '';
                }, COPY_FEEDBACK_DURATION_MS * 2); // 2 seconds for copy feedback
            }).catch(err => {
                btn.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    Failed
                `;
                btn.style.background = 'var(--error-bg)';
                btn.style.borderColor = 'var(--error-border)';
                btn.style.color = 'var(--error-text)';

                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.style.background = '';
                    btn.style.borderColor = '';
                    btn.style.color = '';
                }, COPY_FEEDBACK_DURATION_MS * 2); // 2 seconds for copy feedback
            });
        }

        function copyJson(step, event) {
            const data = jsonResponses[step];
            if (!data) {
                alert('No JSON data to copy');
                return;
            }
            copyToClipboard(JSON.stringify(data, null, 2), event);
        }

        function copyApiJson(step, event) {
            copyJson(step, event);
        }

        function copyRequestCode(step, tabName, event) {
            const container = document.getElementById(`${step}-request-details`);
            if (!container) return;

            // Get the first hidden pre element which contains the plain text cURL command
            const preElements = container.querySelectorAll('pre');
            const content = preElements[0];
            if (!content) return;

            copyToClipboard(content.textContent, event);
        }

        function highlightUrl(url) {
            // Split URL into base and query string
            const [baseUrl, queryString] = url.split('?');

            if (!queryString) {
                // No query parameters, just return the base URL
                return escapeHtml(baseUrl);
            }

            // Base URL + ? in default color
            let highlighted = escapeHtml(baseUrl) + '?';

            // Split query string into parameters and highlight keys/values
            const params = queryString.split('&');
            params.forEach((param, index) => {
                const [key, value] = param.split('=');
                highlighted += `<span style="color: var(--text-secondary);">${escapeHtml(key)}</span>`;
                highlighted += '=';
                highlighted += `<span style="color: var(--text-primary);">${escapeHtml(value || '')}</span>`;

                if (index < params.length - 1) {
                    highlighted += '&';
                }
            });

            return highlighted;
        }

        function displayRequestDetails(step, url, method, headers, body = null) {
            const container = document.getElementById(`${step}-request-details`);
            if (!container) return;

            // Use global API_DOCS_URLS constant
            const apiDocsUrl = API_DOCS_URLS[step] || 'https://docs.layerswap.io';

            // Build headers string
            const headerLines = Object.entries(headers).map(([key, value]) => `  -H "${key}: ${value}"`).join(' \\\n');

            // Build curl command (plain text for copying)
            let curlCmd = `curl -X ${method} \\\n  "${url}"`;
            if (Object.keys(headers).length > 0) {
                curlCmd += ` \\\n${headerLines}`;
            }
            if (body) {
                const bodyStr = JSON.stringify(body, null, 2).replace(/"/g, '\\"');
                curlCmd += ` \\\n  -d "${bodyStr}"`;
            }

            // Build curl command with syntax highlighting
            let curlCmdHighlighted = `<span style="color: #569cd6;">curl</span> <span style="color: #9cdcfe;">-X</span> <span style="color: #ce9178;">${escapeHtml(method)}</span> \\`;
            curlCmdHighlighted += `\n  <span style="color: #ce9178;">"${escapeHtml(url)}"</span>`;
            if (Object.keys(headers).length > 0) {
                curlCmdHighlighted += ` \\`;
                Object.entries(headers).forEach(([key, value]) => {
                    curlCmdHighlighted += `\n  <span style="color: #9cdcfe;">-H</span> <span style="color: #ce9178;">"${escapeHtml(key)}: ${escapeHtml(value)}"</span> \\`;
                });
                curlCmdHighlighted = curlCmdHighlighted.slice(0, -2); // Remove last backslash
            }
            if (body) {
                const bodyStr = JSON.stringify(body, null, 2).replace(/"/g, '\\"');
                curlCmdHighlighted += ` \\\n  <span style="color: #9cdcfe;">-d</span> <span style="color: #ce9178;">"${escapeHtml(bodyStr)}"</span>`;
            }

            container.innerHTML = `
                <div class="flex items-center justify-between gap-3 border-b border-slate-200/60 bg-surface-highlight px-5 py-4 text-sm font-semibold text-ink dark:border-white/10 dark:bg-surface-dark-muted dark:text-ink-invert">
                    <span>API Request</span>
                    <div class="flex items-center gap-2">
                        <button class="request-copy-btn inline-flex items-center gap-2 rounded-md border border-slate-200/60 px-3 py-1.5 text-xs font-medium text-ink-soft transition hover:border-brand hover:text-brand dark:border-white/10 dark:text-ink-invert-soft dark:hover:border-brand dark:hover:text-brand" onclick="copyRequestCode('${step}', 'curl', event)">
                            <i class="fas fa-copy text-[12px]"></i>
                            Copy
                        </button>
                        <a href="${apiDocsUrl}" target="_blank" class="api-docs-link inline-flex items-center gap-2 text-xs font-medium text-ink-soft transition hover:text-brand dark:text-ink-invert-soft dark:hover:text-brand" title="View API Reference">
                            <i class="fas fa-external-link-alt text-[13px]"></i>
                            API Docs
                        </a>
                    </div>
                </div>
                <div class="request-info flex flex-col gap-2 border-b border-slate-200/60 bg-surface-soft px-5 py-4 text-xs text-ink-soft dark:border-white/10 dark:bg-surface-dark-soft dark:text-ink-invert-soft">
                    <div class="request-info-item flex items-baseline gap-2">
                        <div class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">Method:</div>
                        <div class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert">${escapeHtml(method)}</div>
                    </div>
                    <div class="request-info-item flex items-baseline gap-2">
                        <div class="request-info-label font-semibold text-ink-soft dark:text-ink-invert-soft">URL:</div>
                        <div class="request-info-value font-mono text-[11px] font-medium text-ink dark:text-ink-invert break-all">${highlightUrl(url)}</div>
                    </div>
                </div>
                <div class="request-content overflow-auto bg-surface px-5 py-4 font-mono text-[11px] leading-relaxed text-ink dark:bg-surface-dark dark:text-ink-invert-soft max-h-[220px]">
                    <pre class="plain-curl hidden">${curlCmd}</pre>
                    <pre class="m-0 whitespace-pre-wrap leading-relaxed">${curlCmdHighlighted}</pre>
                </div>
            `;
            container.classList.remove('hidden');
        }

        // Store API activity for the sidebar
        const apiActivity = {
            step2: { request: null, response: null },
            step3: { request: null, response: null },
            'step3-destination': { request: null, response: null },
            step4: { request: null, response: null },
            step5: { request: null, response: null }
        };

        async function apiCall(endpoint, method = 'GET', body = null, stepNumber = null) {
            const headers = {
                'Content-Type': 'application/json'
            };

            // Only include API key header if provided
            if (config.apiKey && config.apiKey.trim()) {
                headers['X-LS-APIKEY'] = config.apiKey;
            }

            const options = {
                method,
                headers
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            const fullUrl = `${API_BASE}${endpoint}`;

            // Capture and display the request in the sidebar
            if (stepNumber) {
                const displayHeaders = {};
                if (config.apiKey && config.apiKey.trim()) {
                    displayHeaders['X-LS-APIKEY'] = config.apiKey.trim();
                }
                displayHeaders['Content-Type'] = 'application/json';

                const requestData = {
                    method,
                    endpoint,
                    headers: displayHeaders,
                    body: body || null
                };
                updateApiSidebar(stepNumber, 'request', requestData);
            }

            // Add timeout to fetch request
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), API_TIMEOUT_MS);

            try {
                options.signal = controller.signal;
                const response = await fetch(fullUrl, options);
                clearTimeout(timeoutId);

                // Read response body once
                const text = await response.text();

                // Check if response is ok first
                if (!response.ok) {
                    throw new Error(`API returned status ${response.status}: ${text || 'No error message'}`);
                }

                // Check if response has content
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error(`Expected JSON response but got: ${contentType || 'unknown'}. Response: ${text}`);
                }

                // Check if response body is empty
                if (!text || text.trim() === '') {
                    throw new Error('API returned empty response');
                }

                // Try to parse JSON
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    throw new Error(`Failed to parse API response: ${e.message}`);
                }

                // Check for error in data
                if (data.error) {
                    // Capture error response in sidebar
                    if (stepNumber) {
                        updateApiSidebar(stepNumber, 'response', data, 'error');
                    }
                    // Handle error object properly
                    if (typeof data.error === 'string') {
                        throw new Error(data.error);
                    } else if (data.error.message) {
                        throw new Error(data.error.message);
                    } else {
                        throw new Error(JSON.stringify(data.error));
                    }
                }

                // Capture successful response in sidebar
                if (stepNumber) {
                    updateApiSidebar(stepNumber, 'response', data, 'success');
                }

                return data;
            } catch (err) {
                clearTimeout(timeoutId);
                if (err.name === 'AbortError') {
                    throw new Error(`Request timeout after ${API_TIMEOUT_MS / 1000} seconds`);
                }
                throw err;
            }
        }

        // Function to fetch destinations from the API
        async function fetchDestinations() {
            try {
                const endpoint = `/destinations`;
                const response = await apiCall(endpoint, 'GET');

                if (response && response.data) {
                    // Transform destinations data to work with existing UI
                    // Each destination has a network and its available tokens
                    const networksMap = new Map();

                    response.data.forEach(dest => {
                        if (!networksMap.has(dest.name)) {
                            networksMap.set(dest.name, {
                                name: dest.name,
                                display_name: dest.display_name,
                                logo: dest.logo,
                                chain_id: dest.chain_id,
                                type: dest.type,
                                tokens: []
                            });
                        }

                        const network = networksMap.get(dest.name);

                        // Add the main token from destination
                        if (dest.token && !network.tokens.find(t => t.symbol === dest.token.symbol)) {
                            network.tokens.push({
                                symbol: dest.token.symbol,
                                display_asset: dest.token.display_asset,
                                price_in_usd: dest.token.price_in_usd,
                                decimals: dest.token.decimals,
                                logo: dest.token.logo
                            });
                        }

                        // Add any additional tokens from the tokens array
                        if (dest.tokens && dest.tokens.length > 0) {
                            dest.tokens.forEach(token => {
                                if (!network.tokens.find(t => t.symbol === token.symbol)) {
                                    network.tokens.push(token);
                                }
                            });
                        }
                    });

                    // Convert map to array and add tokenSymbols for compatibility
                    return Array.from(networksMap.values()).map(network => ({
                        ...network,
                        tokenSymbols: network.tokens.map(t => t.symbol)
                    }));
                }
                return [];
            } catch (error) {
                console.error('Error fetching destinations:', error);
                // Return default networks as fallback
                return [
                    { name: 'STARKNET_MAINNET', display_name: 'Starknet', tokens: [{symbol: 'ETH'}, {symbol: 'USDC'}, {symbol: 'USDT'}], tokenSymbols: ['ETH', 'USDC', 'USDT'] },
                    { name: 'BASE_MAINNET', display_name: 'Base', tokens: [{symbol: 'ETH'}, {symbol: 'USDC'}, {symbol: 'USDT'}], tokenSymbols: ['ETH', 'USDC', 'USDT'] }
                ];
            }
        }

        // Define featured networks
        const FEATURED_NETWORKS = [
            'BITCOIN_MAINNET',
            'ETHEREUM_MAINNET',
            'STARKNET_MAINNET',
            'OPTIMISM_MAINNET',
            'FUEL_MAINNET',
            'BASE_MAINNET'
        ];

        // Function to populate destination network dropdown
        function populateDestinationNetworks(networks) {
            const networkSelect = document.getElementById('destinationNetwork');
            const featuredList = document.getElementById('featuredNetworksList');
            const allList = document.getElementById('allNetworksList');

            if (!networkSelect || !featuredList || !allList) return;

            // Clear existing content
            networkSelect.innerHTML = '';
            featuredList.innerHTML = '';
            allList.innerHTML = '';

            // Store networks data globally
            window.networksData = networks;
            window.filteredNetworks = networks;

            // Separate featured and non-featured networks
            const featuredNetworks = [];
            const regularNetworks = [];

            networks.forEach(network => {
                if (FEATURED_NETWORKS.includes(network.name)) {
                    featuredNetworks.push(network);
                } else {
                    regularNetworks.push(network);
                }

                // Add to hidden select for compatibility
                const option = document.createElement('option');
                option.value = network.name;
                option.textContent = network.display_name || formatNetworkName(network.name);
                networkSelect.appendChild(option);
            });

            // Sort featured networks by the order in FEATURED_NETWORKS array
            featuredNetworks.sort((a, b) => {
                return FEATURED_NETWORKS.indexOf(a.name) - FEATURED_NETWORKS.indexOf(b.name);
            });

            // Populate featured networks
            featuredNetworks.forEach(network => {
                const item = createNetworkItem(network, true);
                featuredList.appendChild(item);
            });

            // Populate all networks (including featured)
            networks.forEach(network => {
                const item = createNetworkItem(network, false);
                allList.appendChild(item);
            });

            // Select Base as default if available
            const defaultNetwork = networks.find(n => n.name === 'BASE_MAINNET') || networks[0];
            if (defaultNetwork) {
                selectNetwork(defaultNetwork);
            }

            // Setup dropdown event handlers
            setupDropdownHandlers();
        }

        // Helper function to create a network item element
        function createNetworkItem(network, isFeatured) {
            const item = document.createElement('div');
            item.className = NETWORK_BASE_CLASSES;
            item.dataset.networkName = network.name;

            if (network.logo) {
                const logo = document.createElement('img');
                logo.className = 'h-6 w-6 rounded-full bg-surface-soft object-cover dark:bg-surface-dark-muted';
                logo.src = network.logo;
                logo.alt = network.display_name || network.name;
                logo.onerror = function() {
                    this.style.display = 'none';
                };
                item.appendChild(logo);
            }

            const name = document.createElement('span');
            name.className = 'flex-1 truncate text-sm font-medium text-ink dark:text-ink-invert';
            name.textContent = network.display_name || formatNetworkName(network.name);
            item.appendChild(name);

            if (isFeatured) {
                const star = document.createElement('span');
                star.className = 'ml-auto text-xs text-amber-400';
                star.textContent = '★';
                item.appendChild(star);
            }

            item.addEventListener('click', () => selectNetwork(network));

            return item;
        }

        // Helper function to format network name
        function formatNetworkName(name) {
            return name.replace(/_MAINNET$/, '')
                .replace(/_/g, ' ')
                .toLowerCase()
                .replace(/\b\w/g, char => char.toUpperCase());
        }

        // Function to select a network
        function selectNetwork(network) {
            // Update hidden select
            const select = document.getElementById('destinationNetwork');
            select.value = network.name;

            // Update displayed text
            const selectedText = document.querySelector('#destinationNetworkSelected .selected-text');
            selectedText.textContent = network.display_name || formatNetworkName(network.name);

            // Update selected state in lists
            document.querySelectorAll('.network-item').forEach(item => {
                item.classList.remove('selected');
                removeClasses(item, NETWORK_SELECTED_CLASSES);
                if (item.dataset.networkName === network.name) {
                    item.classList.add('selected');
                    addClasses(item, NETWORK_SELECTED_CLASSES);
                }
            });

            // Close dropdown
            closeDropdown();

            // Update config
            config.destinationNetwork = network.name;

            // Trigger token population
            populateDestinationTokens();

            // Trigger change event for compatibility
            const event = new Event('change');
            select.dispatchEvent(event);
        }

        // Setup dropdown event handlers
        function setupDropdownHandlers() {
            const dropdownSelected = document.getElementById('destinationNetworkSelected');
            const dropdownContent = document.getElementById('destinationNetworkContent');
            const searchInput = document.getElementById('networkSearchInput');

            // Toggle dropdown on click
            dropdownSelected.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = dropdownContent.style.display !== 'none';
                if (isOpen) {
                    closeDropdown();
                } else {
                    openDropdown();
                }
            });

            // Search functionality with debouncing for better performance
            const debouncedFilterNetworks = debounce((searchTerm) => {
                filterNetworks(searchTerm.toLowerCase());
            }, 300);

            searchInput.addEventListener('input', (e) => {
                debouncedFilterNetworks(e.target.value);
            });

            // Prevent dropdown close when clicking inside
            dropdownContent.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', closeDropdown);

            // Keyboard navigation
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeDropdown();
                }
            });
        }

        // Open dropdown
        function openDropdown() {
            // Close token dropdown if open
            closeTokenDropdown();

            const dropdownContent = document.getElementById('destinationNetworkContent');
            const dropdownSelected = document.getElementById('destinationNetworkSelected');
            const searchInput = document.getElementById('networkSearchInput');

            dropdownContent.style.display = 'block';
            dropdownContent.classList.remove('hidden');
            dropdownSelected.classList.add('active');
            addClasses(dropdownSelected, DROPDOWN_ACTIVE_CLASSES);
            const arrow = dropdownSelected.querySelector('.dropdown-arrow');
            if (arrow) arrow.classList.add('rotate-180');

            // Focus search input
            setTimeout(() => searchInput.focus(), 0);
        }

        // Close dropdown
        function closeDropdown() {
            const dropdownContent = document.getElementById('destinationNetworkContent');
            const dropdownSelected = document.getElementById('destinationNetworkSelected');
            const searchInput = document.getElementById('networkSearchInput');

            dropdownContent.style.display = 'none';
            dropdownContent.classList.add('hidden');
            dropdownSelected.classList.remove('active');
            removeClasses(dropdownSelected, DROPDOWN_ACTIVE_CLASSES);
            const arrow = dropdownSelected.querySelector('.dropdown-arrow');
            if (arrow) arrow.classList.remove('rotate-180');

            // Clear search
            searchInput.value = '';
            filterNetworks('');
        }

        // Filter networks based on search
        function filterNetworks(searchTerm) {
            const featuredList = document.getElementById('featuredNetworksList');
            const allList = document.getElementById('allNetworksList');
            const featuredSection = document.getElementById('featuredNetworks');
            const allSection = document.getElementById('allNetworks');

            if (!searchTerm) {
                // Show all networks
                featuredList.querySelectorAll('.network-item').forEach(item => {
                    item.style.display = 'flex';
                });
                allList.querySelectorAll('.network-item').forEach(item => {
                    item.style.display = 'flex';
                });
                featuredSection.style.display = 'block';
                allSection.style.display = 'block';
                return;
            }

            // Filter networks
            let hasFeaturedResults = false;
            let hasAllResults = false;

            featuredList.querySelectorAll('.network-item').forEach(item => {
                const network = window.networksData.find(n => n.name === item.dataset.networkName);
                const displayName = (network.display_name || formatNetworkName(network.name)).toLowerCase();
                const matches = displayName.includes(searchTerm) || network.name.toLowerCase().includes(searchTerm);

                item.style.display = matches ? 'flex' : 'none';
                if (matches) hasFeaturedResults = true;
            });

            allList.querySelectorAll('.network-item').forEach(item => {
                const network = window.networksData.find(n => n.name === item.dataset.networkName);
                const displayName = (network.display_name || formatNetworkName(network.name)).toLowerCase();
                const matches = displayName.includes(searchTerm) || network.name.toLowerCase().includes(searchTerm);

                item.style.display = matches ? 'flex' : 'none';
                if (matches) hasAllResults = true;
            });

            // Hide sections if no results
            featuredSection.style.display = hasFeaturedResults ? 'block' : 'none';
            allSection.style.display = hasAllResults ? 'block' : 'none';

            // Show no results message if needed
            if (!hasFeaturedResults && !hasAllResults) {
                if (!document.querySelector('.no-results')) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-results px-4 py-6 text-center text-sm text-ink-soft dark:text-ink-invert-soft';
                    noResults.textContent = 'No networks found';
                    document.getElementById('destinationNetworkContent').querySelector('.dropdown-sections').appendChild(noResults);
                }
            } else {
                const noResults = document.querySelector('.no-results');
                if (noResults) noResults.remove();
            }
        }

        // Function to populate destination tokens based on selected network
        function populateDestinationTokens() {
            const networkSelect = document.getElementById('destinationNetwork');
            const tokenSelect = document.getElementById('destinationToken');
            const tokensList = document.getElementById('allTokensList');

            if (!networkSelect || !tokenSelect || !tokensList) return;

            const selectedNetwork = networkSelect.value;
            const networkData = window.networksData?.find(n => n.name === selectedNetwork);

            // Clear existing content
            tokenSelect.innerHTML = '';
            tokensList.innerHTML = '';

            // Store tokens globally for search functionality
            window.availableTokens = [];

            if (networkData) {
                // Handle tokens array with full token data
                if (networkData.tokens && networkData.tokens.length > 0) {
                    window.availableTokens = networkData.tokens;

                    networkData.tokens.forEach((tokenData, index) => {
                        // Create token item for custom dropdown
                        const tokenItem = createTokenItem(tokenData);
                        tokensList.appendChild(tokenItem);

                        // Add to hidden select for compatibility
                        const option = document.createElement('option');
                        option.value = tokenData.symbol;
                        option.textContent = tokenData.symbol;
                        tokenSelect.appendChild(option);

                        // Select ETH as default if available, or the first token
                        if (tokenData.symbol === 'ETH' || (index === 0 && !networkData.tokens.find(t => t.symbol === 'ETH'))) {
                            selectToken(tokenData);
                        }
                    });
                }
                // Handle simple token symbols array (fallback)
                else if (networkData.tokenSymbols && networkData.tokenSymbols.length > 0) {
                    window.availableTokens = networkData.tokenSymbols.map(symbol => ({ symbol }));

                    networkData.tokenSymbols.forEach((token, index) => {
                        const tokenData = { symbol: token };
                        // Create token item for custom dropdown
                        const tokenItem = createTokenItem(tokenData);
                        tokensList.appendChild(tokenItem);

                        // Add to hidden select for compatibility
                        const option = document.createElement('option');
                        option.value = token;
                        option.textContent = token;
                        tokenSelect.appendChild(option);

                        // Select ETH as default if available, or the first token
                        if (token === 'ETH' || (index === 0 && !networkData.tokenSymbols.includes('ETH'))) {
                            selectToken(tokenData);
                        }
                    });
                }
            }

            // Fallback tokens if network data not available
            if (window.availableTokens.length === 0) {
                const fallbackTokens = ['ETH', 'USDC', 'USDT'];
                window.availableTokens = fallbackTokens.map(symbol => ({ symbol }));

                fallbackTokens.forEach((token, index) => {
                    const tokenData = { symbol: token };
                    // Create token item for custom dropdown
                    const tokenItem = createTokenItem(tokenData);
                    tokensList.appendChild(tokenItem);

                    // Add to hidden select
                    const option = document.createElement('option');
                    option.value = token;
                    option.textContent = token;
                    tokenSelect.appendChild(option);

                    if (index === 0) {
                        selectToken(tokenData);
                    }
                });
            }

            // Setup token dropdown handlers if not already done
            if (!window.tokenDropdownInitialized) {
                setupTokenDropdownHandlers();
                window.tokenDropdownInitialized = true;
            }
        }

        // Helper function to create a token item element
        function createTokenItem(tokenData) {
            const item = document.createElement('div');
            item.className = TOKEN_BASE_CLASSES;
            item.dataset.tokenSymbol = tokenData.symbol;
            item.dataset.selected = 'false';

            if (tokenData.logo) {
                const logo = document.createElement('img');
                logo.className = 'h-6 w-6 rounded-full bg-surface-soft object-cover dark:bg-surface-dark-muted';
                logo.src = tokenData.logo;
                logo.alt = tokenData.symbol;
                logo.onerror = function() {
                    this.style.display = 'none';
                };
                item.appendChild(logo);
            }

            const symbol = document.createElement('span');
            symbol.className = 'text-sm font-medium text-ink dark:text-ink-invert';
            symbol.textContent = tokenData.symbol;
            item.appendChild(symbol);

            if (tokenData.price_in_usd) {
                const price = document.createElement('span');
                price.className = 'ml-auto text-xs text-ink-soft dark:text-ink-invert-soft';
                price.textContent = `$${tokenData.price_in_usd.toFixed(2)}`;
                item.appendChild(price);
            }

            item.addEventListener('click', () => selectToken(tokenData));

            return item;
        }

        // Function to select a token
        function selectToken(tokenData) {
            // Update hidden select
            const select = document.getElementById('destinationToken');
            select.value = tokenData.symbol;

            // Update displayed text
            const selectedText = document.querySelector('#destinationTokenSelected .selected-text');
            selectedText.textContent = tokenData.symbol;

            // Update selected state in list
            document.querySelectorAll('.token-item').forEach(item => {
                item.classList.remove('selected');
                removeClasses(item, TOKEN_SELECTED_CLASSES);
                item.dataset.selected = 'false';
                if (item.dataset.tokenSymbol === tokenData.symbol) {
                    item.classList.add('selected');
                    addClasses(item, TOKEN_SELECTED_CLASSES);
                    item.dataset.selected = 'true';
                }
            });

            // Close dropdown
            closeTokenDropdown();

            // Update config
            config.destinationToken = tokenData.symbol;

            // Trigger change event for compatibility
            const event = new Event('change');
            select.dispatchEvent(event);
        }

        // Setup token dropdown event handlers
        function setupTokenDropdownHandlers() {
            const dropdownSelected = document.getElementById('destinationTokenSelected');
            const dropdownContent = document.getElementById('destinationTokenContent');
            const searchInput = document.getElementById('tokenSearchInput');

            // Toggle dropdown on click
            dropdownSelected.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = dropdownContent.style.display !== 'none';
                if (isOpen) {
                    closeTokenDropdown();
                } else {
                    openTokenDropdown();
                }
            });

            // Search functionality with debouncing for better performance
            const debouncedFilterTokens = debounce((searchTerm) => {
                filterTokens(searchTerm.toLowerCase());
            }, 300);

            searchInput.addEventListener('input', (e) => {
                debouncedFilterTokens(e.target.value);
            });

            // Prevent dropdown close when clicking inside
            dropdownContent.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                // Don't close if clicking on the network dropdown
                if (!e.target.closest('#destinationNetworkDropdown') && !e.target.closest('#destinationTokenDropdown')) {
                    closeTokenDropdown();
                }
            });

            // Keyboard navigation
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeTokenDropdown();
                }
            });
        }

        // Open token dropdown
        function openTokenDropdown() {
            // Close network dropdown if open
            closeDropdown();

            const dropdownContent = document.getElementById('destinationTokenContent');
            const dropdownSelected = document.getElementById('destinationTokenSelected');
            const searchInput = document.getElementById('tokenSearchInput');

            dropdownContent.style.display = 'block';
            dropdownContent.classList.remove('hidden');
            dropdownSelected.classList.add('active');
            addClasses(dropdownSelected, DROPDOWN_ACTIVE_CLASSES);
            const arrow = dropdownSelected.querySelector('.dropdown-arrow');
            if (arrow) arrow.classList.add('rotate-180');

            // Focus search input
            setTimeout(() => searchInput.focus(), 0);
        }

        // Close token dropdown
        function closeTokenDropdown() {
            const dropdownContent = document.getElementById('destinationTokenContent');
            const dropdownSelected = document.getElementById('destinationTokenSelected');
            const searchInput = document.getElementById('tokenSearchInput');

            dropdownContent.style.display = 'none';
            dropdownContent.classList.add('hidden');
            dropdownSelected.classList.remove('active');
            removeClasses(dropdownSelected, DROPDOWN_ACTIVE_CLASSES);
            const arrow = dropdownSelected.querySelector('.dropdown-arrow');
            if (arrow) arrow.classList.remove('rotate-180');

            // Clear search
            searchInput.value = '';
            filterTokens('');
        }

        // Filter tokens based on search
        function filterTokens(searchTerm) {
            const tokensList = document.getElementById('allTokensList');

            if (!searchTerm) {
                // Show all tokens
                tokensList.querySelectorAll('.token-item').forEach(item => {
                    item.style.display = 'flex';
                });

                // Remove no results message if exists
                const noResults = tokensList.querySelector('.no-results');
                if (noResults) noResults.remove();
                return;
            }

            // Filter tokens
            let hasResults = false;

            tokensList.querySelectorAll('.token-item').forEach(item => {
                const tokenData = window.availableTokens.find(t => t.symbol === item.dataset.tokenSymbol);
                const matches = tokenData.symbol.toLowerCase().includes(searchTerm);

                item.style.display = matches ? 'flex' : 'none';
                if (matches) hasResults = true;
            });

            // Show no results message if needed
            if (!hasResults) {
                if (!tokensList.querySelector('.no-results')) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-results px-4 py-6 text-center text-sm text-ink-soft dark:text-ink-invert-soft';
                    noResults.textContent = 'No tokens found';
                    tokensList.appendChild(noResults);
                }
            } else {
                const noResults = tokensList.querySelector('.no-results');
                if (noResults) noResults.remove();
            }
        }

        // Function to update the API sidebar with request/response data
        function updateApiSidebar(stepNumber, type, data, status = 'success') {
            const emptyState = document.getElementById('api-empty-state');
            if (emptyState) {
                emptyState.classList.add('hidden');
            }

            const stepKey = stepNumber === '3-destination' ? 'step3-destination' : `step${stepNumber}`;

            // Store the data
            if (type === 'request') {
                apiActivity[stepKey].request = data;

                // Display the request in the sidebar with curl command
                const endpoint = data.endpoint;
                const fullUrl = `${API_BASE}${endpoint}`;
                const headers = {};

                // Only include API key header if provided
                if (config.apiKey && config.apiKey.trim()) {
                    headers['X-LS-APIKEY'] = config.apiKey;
                }
                headers['Content-Type'] = 'application/json';

                displayRequestDetailsInSidebar(stepKey, fullUrl, data.method, headers, data.body);

            } else if (type === 'response') {
                apiActivity[stepKey].response = data;

                // Show and update response card using existing displayJsonResponse function
                displayJsonResponse(stepKey, data, true);

                // Show the response card
                const responseCard = document.getElementById(`${stepKey}-response-card`);
                if (responseCard) {
                    responseCard.classList.remove('hidden');
                    responseCard.classList.add('flex');
                    responseCard.style.removeProperty('display');
                }
            }
        }

        // New function to display request details in sidebar
        function displayRequestDetailsInSidebar(step, url, method, headers, body = null) {
            const curlElement = document.getElementById(`${step}-request-curl`);
            const requestContent = document.getElementById(`${step}-request-content`);
            const requestCard = document.getElementById(`${step}-request-details`);
            if (!curlElement) return;

            // Show the request content div now that we have a request
            if (requestContent) {
                requestContent.classList.remove('hidden');
                requestContent.classList.add('block');
                requestContent.style.removeProperty('display');
            }
            if (requestCard) {
                requestCard.classList.remove('hidden');
            }

            // Build headers string
            const headerLines = Object.entries(headers).map(([key, value]) => {
                const displayValue = value ?? '';
                return `  -H "${key}: ${displayValue}"`;
            }).join(' \\\n');

            // Build plain curl command for copy support
            let curlCmd = `curl -X ${method} \\\n  "${url}"`;
            if (Object.keys(headers).length > 0) {
                curlCmd += ` \\\n${headerLines}`;
            }
            if (body) {
                const bodyStr = JSON.stringify(body, null, 2).replace(/"/g, '\\"');
                curlCmd += ` \\\n  -d "${bodyStr}"`;
            }

            // Build curl command with syntax highlighting
            let curlCmdHighlighted = `<span style="color: #569cd6;">curl</span> <span style="color: #9cdcfe;">-X</span> <span style="color: #ce9178;">${escapeHtml(method)}</span> \\`;
            curlCmdHighlighted += `\n  <span style="color: #ce9178;">"${escapeHtml(url)}"</span>`;
            if (Object.keys(headers).length > 0) {
                curlCmdHighlighted += ` \\`;
                Object.entries(headers).forEach(([key, value]) => {
                    const displayValue = value ?? '';
                    curlCmdHighlighted += `\n  <span style="color: #9cdcfe;">-H</span> <span style="color: #ce9178;">"${escapeHtml(key)}: ${escapeHtml(displayValue)}"</span> \\`;
                });
                curlCmdHighlighted = curlCmdHighlighted.slice(0, -2); // Remove last backslash
            }
            if (body) {
                const bodyStr = JSON.stringify(body, null, 2).replace(/"/g, '\\"');
                curlCmdHighlighted += ` \\\n  <span style="color: #9cdcfe;">-d</span> <span style="color: #ce9178;">"${escapeHtml(bodyStr)}"</span>`;
            }

            // Populate plain curl for copy button
            const plainCurl = requestContent ? requestContent.querySelector('.plain-curl') : null;
            if (plainCurl) {
                plainCurl.classList.remove('hidden');
                plainCurl.textContent = curlCmd;
            }

            curlElement.innerHTML = curlCmdHighlighted;
        }


        const API_SECTION_ORDER = ['1', '2', '3-destination', '3', '4', '5'];

        function getApiSectionKey(stepId) {
            if (stepId === 'step3-destination') return '3-destination';
            const match = stepId.match(/step(\d)/);
            if (match) return match[1];
            return '1';
        }

        function sectionHasRequestData(section) {
            if (!section) return false;
            const curlSpan = section.querySelector('[id$="-request-curl"]');
            const plainCurl = section.querySelector('.plain-curl');
            const text = `${curlSpan?.textContent || ''}${plainCurl?.textContent || ''}`.trim();
            return Boolean(text.length);
        }

        function sectionHasResponseData(section) {
            if (!section) return false;
            const responseCard = section.querySelector('.api-response-card');
            return Boolean(responseCard && !responseCard.classList.contains('hidden'));
        }

        function sectionHasData(section) {
            return sectionHasRequestData(section) || sectionHasResponseData(section);
        }

        function clearApiSection(stepKey) {
            if (!stepKey) return;
            if (apiActivity[stepKey]) {
                apiActivity[stepKey].request = null;
                apiActivity[stepKey].response = null;
            }

            const requestContent = document.getElementById(`${stepKey}-request-content`);
            const curlElement = document.getElementById(`${stepKey}-request-curl`);
            const plainCurl = requestContent?.querySelector('.plain-curl');
            if (requestContent) {
                requestContent.classList.add('hidden');
                requestContent.classList.remove('block');
                requestContent.style.removeProperty('display');
            }
            if (curlElement) {
                curlElement.innerHTML = '';
            }
            const requestCard = document.getElementById(`${stepKey}-request-details`);
            if (requestCard) {
                requestCard.classList.add('hidden');
            }
            if (plainCurl) {
                plainCurl.textContent = '';
            }

            const responseCard = document.getElementById(`${stepKey}-response-card`);
            if (responseCard) {
                responseCard.classList.add('hidden');
                responseCard.classList.remove('flex');
                responseCard.style.removeProperty('display');
            }
            const jsonData = document.getElementById(`${stepKey}-json-data`);
            if (jsonData) {
                jsonData.innerHTML = '';
            }
        }

        // Function to update API sidebar based on current step
        function updateApiSidebarForStep(stepId) {
            const allSections = document.querySelectorAll('.api-step-section');
            allSections.forEach(section => {
                section.classList.add('hidden');
            });

            const currentKey = getApiSectionKey(stepId);
            let sectionToShow = document.querySelector(`[data-step="${currentKey}"]`);
            const emptyState = document.getElementById('api-empty-state');

            if (!sectionHasData(sectionToShow)) {
                sectionToShow = null;
                const currentIndex = API_SECTION_ORDER.indexOf(currentKey);

                for (let i = currentIndex + 1; i < API_SECTION_ORDER.length; i++) {
                    const nextSection = document.querySelector(`[data-step="${API_SECTION_ORDER[i]}"]`);
                    if (sectionHasData(nextSection)) {
                        sectionToShow = nextSection;
                        break;
                    }
                }

                if (!sectionToShow) {
                    for (let i = currentIndex - 1; i >= 0; i--) {
                        const prevSection = document.querySelector(`[data-step="${API_SECTION_ORDER[i]}"]`);
                        if (sectionHasData(prevSection)) {
                            sectionToShow = prevSection;
                            break;
                        }
                    }
                }
            }

            if (sectionToShow) {
                sectionToShow.classList.remove('hidden');
                sectionToShow.style.removeProperty('display');
                if (emptyState) {
                    emptyState.classList.add('hidden');
                }
            } else if (emptyState) {
                emptyState.classList.remove('hidden');
            }
        }

        // Handle token mode change
        function handleModeChange() {
            const mode = document.querySelector('input[name="tokenMode"]:checked').value;
            state.tokenMode = mode;

            // Show/hide relevant elements
            const destTokenGroup = document.getElementById('destinationTokenGroup');
            const multipleTokensStep = document.getElementById('step3-destination');
            const multipleTokensNav = document.querySelectorAll('.multiple-tokens-nav');
            const singleModeElements = document.querySelectorAll('.single-token-mode');
            const multipleModeElements = document.querySelectorAll('.multiple-tokens-mode');

            if (mode === 'single') {
                // Single token mode
                destTokenGroup.style.display = 'block';
                multipleTokensStep.style.display = 'none';
                multipleTokensNav.forEach(el => el.style.display = 'none');
                singleModeElements.forEach(el => el.style.display = 'block');
                multipleModeElements.forEach(el => el.style.display = 'none');

                // Update step numbers
                document.getElementById('step3-number').textContent = 'Step 3:';
                document.getElementById('step4-number').textContent = 'Step 4:';
                document.getElementById('step5-number').textContent = 'Step 5:';
                document.getElementById('nav-step3-label').textContent = 'Step 3:';
                document.getElementById('nav-step4-label').textContent = 'Step 4:';
                document.getElementById('nav-step5-label').textContent = 'Step 5:';
            } else {
                // Multiple tokens mode
                destTokenGroup.style.display = 'none';
                multipleTokensStep.style.display = 'block';
                multipleTokensNav.forEach(el => el.style.display = 'block');
                singleModeElements.forEach(el => el.style.display = 'none');
                multipleModeElements.forEach(el => el.style.display = 'block');

                // Update step numbers
                document.getElementById('step3-number').textContent = 'Step 4:';
                document.getElementById('step4-number').textContent = 'Step 5:';
                document.getElementById('step5-number').textContent = 'Step 6:';
                document.getElementById('nav-step3-label').textContent = 'Step 4:';
                document.getElementById('nav-step4-label').textContent = 'Step 5:';
                document.getElementById('nav-step5-label').textContent = 'Step 6:';
            }

            // Reset subsequent steps
            resetStepsFrom(2);

            // Re-setup scroll spy with new sections
            setupScrollSpy();

            // Trigger validation to potentially unlock next step
            updateConfig();
        }

        // Reset steps from a given step number
        function resetStepsFrom(stepNum) {
            // Reset state for steps
            if (stepNum <= 2) {
                state.sourceNetwork = '';
                state.sourceToken = '';
                document.getElementById('sourceNetworks').innerHTML = '';
                document.getElementById('sourceNetworks').classList.add('hidden');
                document.getElementById('selectedNetworkInfo').classList.add('hidden');
                document.getElementById('sourceTokenSelector').classList.add('hidden');
            }
            if (stepNum <= 3) {
                state.destinationTokenMultiple = '';
                document.getElementById('destinationTokens').innerHTML = '';
                document.getElementById('destinationTokens').classList.add('hidden');
                document.getElementById('selectedDestTokenInfo').classList.add('hidden');
            }

            // Lock subsequent steps
            for (let i = stepNum; i <= 5; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) {
                    step.classList.add('locked');
                }
                const navItem = document.getElementById(`nav-step${i}`);
                if (navItem) {
                    navItem.classList.add('locked');
                }
            }

            // Also lock the destination token step
            if (stepNum <= 3) {
                const destStep = document.getElementById('step3-destination');
                if (destStep) {
                    destStep.classList.add('locked');
                }
                const destNav = document.getElementById('nav-step3-destination');
                if (destNav) {
                    destNav.classList.add('locked');
                }
            }

            // Clear JSON responses for reset steps
            const apiStepKeys = ['step2', 'step3-destination', 'step3', 'step4', 'step5'];
            const startIndex = Math.max(0, stepNum - 2);
            apiStepKeys.slice(startIndex).forEach(step => {
                if (jsonResponses[step]) {
                    delete jsonResponses[step];
                }
                clearApiSection(step);
            });

            if (stepNum <= 2) {
                const emptyState = document.getElementById('api-empty-state');
                if (emptyState) {
                    emptyState.classList.remove('hidden');
                }
                document.querySelectorAll('.api-step-section').forEach(section => {
                    section.classList.add('hidden');
                    section.classList.remove('flex');
                    section.style.removeProperty('display');
                });
            }

            updateApiSidebarForStep('step1');
        }

        async function getSources() {
            const params = new URLSearchParams();

            // In single token mode, include destination_token
            if (state.tokenMode === 'single') {
                params.append('destination_network', config.destinationNetwork);
                params.append('destination_token', config.destinationToken);
            } else {
                // In multiple tokens mode, only include network
                params.append('destination_network', config.destinationNetwork);
            }

            // Important: Only show sources that support deposit address generation
            params.append('has_deposit_address', 'true');

            const endpoint = `/sources?${params.toString()}`;
            const fullUrl = `${API_BASE}${endpoint}`;

            const resultBox = document.getElementById('step2-result');
            showResult(resultBox, 'Loading...');

            try {
                const data = await apiCall(endpoint, 'GET', null, 2);

                if (!data.data || data.data.length === 0) {
                    showResult(resultBox, 'No networks available for this destination.', { variant: 'error' });
                    return;
                }

                showResult(resultBox, `Found ${data.data.length} available networks`, { variant: 'success' });

                displaySources(data.data);

            } catch (error) {
                showResult(resultBox, `Error: ${error.message || 'Failed to fetch networks'}`, { variant: 'error' });
            }
        }

        async function displaySources(sources) {
            const container = document.getElementById('sourceNetworks');
            container.innerHTML = '';
            container.classList.remove('hidden');

            try {

                // Sources response structure: each source IS a network with route_tokens
                const networks = {};
                sources.forEach(source => {
                    // The source object itself is the network
                    const networkName = source.name;

                    // Store source data in networkMap for later use
                    state.networkMap[networkName] = source;

                    const networkInfo = state.networkMap[networkName] || source;

                    if (!networks[networkName]) {
                        networks[networkName] = {
                            tokens: new Set(),
                            logo: networkInfo.logo || source.logo || '',
                            displayName: networkInfo.display_name || source.display_name || networkName
                        };
                    }

                    // Add all tokens
                    if (source.tokens && Array.isArray(source.tokens)) {
                        source.tokens.forEach(token => {
                            networks[networkName].tokens.add(token.symbol || token.asset);
                        });
                    }
                });

                Object.entries(networks).forEach(([network, info]) => {
                    if (info.tokens.size === 0) return;

                    const card = document.createElement('button');
                    card.type = 'button';
                    card.className = SOURCE_CARD_BASE_CLASSES;
                    card.dataset.network = network;
                    card.dataset.selected = 'false';
                    card.setAttribute('aria-pressed', 'false');

                    const shortName = info.displayName
                        .replace(/_MAINNET/g, '')
                        .replace(/_SEPOLIA/g, ' Sep')
                        .replace(/_/g, ' ');

                    const tokensArray = Array.from(info.tokens);
                    const firstToken = tokensArray[0];

                    if (info.logo) {
                        const logo = document.createElement('img');
                        logo.className = 'h-8 w-8 rounded-full bg-surface-soft object-contain dark:bg-surface-dark-muted';
                        logo.src = info.logo;
                        logo.alt = shortName;
                        logo.onerror = function () {
                            this.classList.add('hidden');
                        };
                        card.appendChild(logo);
                    }

                    const label = document.createElement('span');
                    label.className = 'text-sm font-semibold text-ink dark:text-ink-invert';
                    label.textContent = shortName;
                    card.appendChild(label);

                    const tokenMeta = document.createElement('span');
                    tokenMeta.className = 'text-[11px] font-medium text-ink-soft dark:text-ink-invert-soft';
                    tokenMeta.textContent = tokensArray.slice(0, 3).join(', ') + (tokensArray.length > 3 ? '...' : '');
                    card.appendChild(tokenMeta);

                    if (firstToken) {
                        card.dataset.token = firstToken;
                        card.addEventListener('click', () => selectSource(network, firstToken, card));
                        card.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter' || event.key === ' ') {
                                event.preventDefault();
                                selectSource(network, firstToken, card);
                            }
                        });
                    }

                    container.appendChild(card);
                });
            } catch (error) {
                // Still display networks without logos if fetch fails
                sources.forEach(source => {
                    const networkName = source.name || 'Unknown';
                    const displayName = source.display_name || networkName;
                    const tokens = source.tokens || [];

                    const card = document.createElement('button');
                    card.type = 'button';
                    card.className = SOURCE_CARD_BASE_CLASSES;
                    card.dataset.network = networkName;
                    card.dataset.selected = 'false';
                    card.setAttribute('aria-pressed', 'false');

                    const shortName = displayName
                        .replace(/_MAINNET/g, '')
                        .replace(/_SEPOLIA/g, ' Sep')
                        .replace(/_/g, ' ');

                    const fallbackTokens = tokens.map(t => t.symbol || t.asset);

                    const label = document.createElement('span');
                    label.className = 'text-sm font-semibold text-ink dark:text-ink-invert';
                    label.textContent = shortName;
                    card.appendChild(label);

                    const tokenMeta = document.createElement('span');
                    tokenMeta.className = 'text-[11px] font-medium text-ink-soft dark:text-ink-invert-soft';
                    tokenMeta.textContent = fallbackTokens.slice(0, 3).join(', ') + (fallbackTokens.length > 3 ? '...' : '');
                    card.appendChild(tokenMeta);

                    const firstToken = tokens[0]?.symbol || tokens[0]?.asset;
                    if (firstToken) {
                        card.dataset.token = firstToken;
                        card.addEventListener('click', () => selectSource(networkName, firstToken, card));
                        card.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter' || event.key === ' ') {
                                event.preventDefault();
                                selectSource(networkName, firstToken, card);
                            }
                        });
                        container.appendChild(card);
                    }
                });
            }
        }

        function selectSource(network, token, element) {
            document.querySelectorAll('.source-card').forEach(el => {
                removeClasses(el, SOURCE_CARD_SELECTED_CLASSES);
                el.dataset.selected = 'false';
                el.setAttribute('aria-pressed', 'false');
            });
            if (element) {
                addClasses(element, SOURCE_CARD_SELECTED_CLASSES);
                element.dataset.selected = 'true';
                element.setAttribute('aria-pressed', 'true');
            }

            state.sourceNetwork = network;
            const displayName = network.replace(/_/g, ' ');

            if (state.tokenMode === 'single') {
                // Single token mode - select both network and token
                state.sourceToken = token;

                // Show selected network info with token
                document.getElementById('selectedNetworkName').textContent = displayName;
                document.getElementById('selectedTokenName').textContent = `(${token})`; // Show the selected token
                document.getElementById('selectedNetworkInfo').classList.remove('hidden');

                // Update step 3 description
                const destDisplay = config.destinationNetwork.replace(/_/g, ' ');
                const destTokenDisplay = config.destinationToken ? ` (${config.destinationToken})` : '';
                document.getElementById('destNetworkDisplay').textContent = `${destDisplay}${destTokenDisplay}`;
                document.getElementById('sourceNetworkQuoteDisplay').textContent = `${displayName} (${token})`;

                // Unlock and enable step 3 (Get Quote)
                document.getElementById('step3').classList.remove('locked');
                document.getElementById('quoteBtn').disabled = false;
                unlockNavItem('step3');
            } else {
                // Multiple tokens mode - show token selector
                document.getElementById('selectedNetworkName').textContent = displayName;
                document.getElementById('selectedTokenName').textContent = ''; // Clear token name until selected
                document.getElementById('selectedNetworkInfo').classList.remove('hidden');

                // Get tokens for this network
                const networkData = state.networkMap[network];
                if (networkData && networkData.tokens) {
                    const tokenSelector = document.getElementById('sourceTokenSelector');
                    const tokenSelect = document.getElementById('sourceToken');

                    // Clear and populate token selector
                    tokenSelect.innerHTML = '<option value="">Select a token</option>';
                    networkData.tokens.forEach(token => {
                        const option = document.createElement('option');
                        option.value = token.symbol || token.asset;
                        option.textContent = token.symbol || token.asset;
                        tokenSelect.appendChild(option);
                    });

                    // If there's only one token, auto-select it
                    if (networkData.tokens.length === 1) {
                        tokenSelect.selectedIndex = 1; // Select first token option (after "Select a token")
                        // Trigger the selection
                        handleSourceTokenSelect();
                    } else {
                        // Show token selector for multiple tokens
                        tokenSelector.classList.remove('hidden');
                    }
                } else {
                    // If no tokens data stored, show a message
                    safeConsole.error('No token data found for network:', network);
                    const tokenSelector = document.getElementById('sourceTokenSelector');
                    tokenSelector.classList.remove('hidden');
                    document.getElementById('sourceToken').innerHTML = '<option value="">No tokens available</option>';
                }
            }
        }

        // Handle source token selection in multiple tokens mode
        function handleSourceTokenSelect() {
            const tokenSelect = document.getElementById('sourceToken');
            const selectedToken = tokenSelect.value;

            if (!selectedToken) return;

            state.sourceToken = selectedToken;

            // Update display
            document.getElementById('selectedTokenName').textContent = `(${selectedToken})`;

            // Update destination network display for next step
            const destDisplay = config.destinationNetwork.replace(/_/g, ' ');
            document.getElementById('destNetworkForTokens').textContent = destDisplay;

            // Unlock step 3 (Select Destination)
            document.getElementById('step3-destination').classList.remove('locked');
            document.getElementById('getDestTokensBtn').disabled = false;
            unlockNavItem('step3-destination');
        }

        // Get destination tokens for multiple tokens mode
        async function getDestinationTokens() {
            const params = new URLSearchParams({
                source_network: state.sourceNetwork,
                source_token: state.sourceToken
            });

            const endpoint = `/destinations?${params.toString()}`;
            const fullUrl = `${API_BASE}${endpoint}`;

            const resultBox = document.getElementById('step3-destination-result');
            showResult(resultBox, 'Loading...');

            try {
                const data = await apiCall(endpoint, 'GET', null, '3-destination');

                // Find destination tokens for our selected network
                const destinations = data.data || [];
                const ourDestination = destinations.find(d => d.name === config.destinationNetwork);

                if (ourDestination && ourDestination.tokens) {
                    showResult(resultBox, `Found ${ourDestination.tokens.length} available tokens`, { variant: 'success' });

                    // Display tokens as a grid
                    const container = document.getElementById('destinationTokens');
                    container.innerHTML = '';
                    container.classList.remove('hidden');

                    ourDestination.tokens.forEach(token => {
                        const tokenSymbol = token.symbol || token.asset;
                        const tokenLogo = token.logo;
                        const tokenCard = document.createElement('button');
                        tokenCard.type = 'button';
                        tokenCard.className = TOKEN_GRID_CARD_BASE_CLASSES;
                        tokenCard.dataset.tokenSymbol = tokenSymbol;
                        tokenCard.dataset.selected = 'false';
                        tokenCard.setAttribute('aria-pressed', 'false');
                        tokenCard.addEventListener('click', () => selectDestinationToken(tokenSymbol, tokenCard));
                        tokenCard.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter' || event.key === ' ') {
                                event.preventDefault();
                                selectDestinationToken(tokenSymbol, tokenCard);
                            }
                        });

                        if (tokenLogo) {
                            const logo = document.createElement('img');
                            logo.className = 'h-9 w-9 rounded-full bg-surface-soft object-contain dark:bg-surface-dark-muted';
                            logo.src = tokenLogo;
                            logo.alt = tokenSymbol;
                            logo.onerror = function () {
                                this.classList.add('hidden');
                            };
                            tokenCard.appendChild(logo);
                        }

                        const label = document.createElement('span');
                        label.className = 'text-sm font-semibold text-ink dark:text-ink-invert';
                        label.textContent = tokenSymbol;
                        tokenCard.appendChild(label);

                        container.appendChild(tokenCard);
                    });
                } else {
                    showResult(resultBox, '⚠️ No tokens available for this route', { variant: 'error' });
                }
            } catch (error) {
                showResult(resultBox, `Error: ${error.message || 'Failed to get destination tokens'}`, { variant: 'error' });
            }
        }

        // Select destination token in multiple tokens mode
        function selectDestinationToken(token, element) {
            document.querySelectorAll('#destinationTokens .token-card').forEach(el => {
                removeClasses(el, TOKEN_GRID_SELECTED_CLASSES);
                el.dataset.selected = 'false';
                el.setAttribute('aria-pressed', 'false');
            });
            addClasses(element, TOKEN_GRID_SELECTED_CLASSES);
            element.dataset.selected = 'true';
            element.setAttribute('aria-pressed', 'true');

            state.destinationTokenMultiple = token;

            // Update display
            document.getElementById('selectedDestTokenName').textContent = token;
            document.getElementById('selectedDestTokenInfo').classList.remove('hidden');

            // Update quote description
            const sourceDisplay = state.sourceNetwork.replace(/_/g, ' ');
            const destDisplay = config.destinationNetwork.replace(/_/g, ' ');
            document.getElementById('sourceNetworkQuoteDisplay').textContent = `${sourceDisplay} (${state.sourceToken})`;
            document.getElementById('destNetworkDisplay').textContent = `${destDisplay} (${token})`;

            // Unlock Get Quote step
            document.getElementById('step3').classList.remove('locked');
            document.getElementById('quoteBtn').disabled = false;
            unlockNavItem('step3');
        }

        async function getQuote() {
            const params = new URLSearchParams({
                source_network: state.sourceNetwork,
                source_token: state.sourceToken,
                destination_network: config.destinationNetwork,
                destination_token: state.tokenMode === 'single' ? config.destinationToken : state.destinationTokenMultiple,
                destination_address: config.walletAddress,
                refuel: false
            });

            const endpoint = `/detailed_quote?${params.toString()}`;
            const fullUrl = `${API_BASE}${endpoint}`;

            const resultBox = document.getElementById('step3-result');
            showResult(resultBox, 'Loading...');

            try {
                const data = await apiCall(endpoint, 'GET', null, 3);
                const quotes = data.data || []; // All available quote paths

                if (quotes.length === 0) {
                    throw new Error('No quotes available for this route');
                }

                // Store the max amount from the highest tier for later use
                state.maxAmount = Math.max(...quotes.map(q => q.max_amount || 0));

                showResult(resultBox, `Found ${quotes.length} liquidity path${quotes.length > 1 ? 's' : ''}`, { variant: 'success' });

                // Display quote details
                const quoteContainer = document.getElementById('quoteDetails');

                // Helper function to format time
                const formatTime = (ms) => {
                    if (!ms || ms === 0) return 'Instant';
                    const totalSeconds = Math.floor(ms / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;

                    if (hours > 0) {
                        return `~${hours}h ${minutes}m`;
                    } else if (minutes > 0) {
                        return `~${minutes}m`;
                    } else {
                        return `~${seconds}s`;
                    }
                };

                // Build HTML for all quote paths
                const buildFeeCard = (label, value, usdValue) => `
                    <div class="rounded-xl bg-surface-soft p-3 text-xs text-ink shadow-sm dark:bg-surface-dark-soft dark:text-ink-invert">
                        <p class="text-[10px] font-semibold uppercase tracking-[0.32em] text-ink-soft dark:text-ink-invert-soft">${label}</p>
                        <p class="text-sm font-semibold text-ink dark:text-ink-invert">${value}</p>
                        ${usdValue ? `<p class="text-[11px] text-ink-soft dark:text-ink-invert-soft">≈ $${usdValue}</p>` : ''}
                    </div>
                `;

                const buildRoutePath = (path) => {
                    if (!path || path.length === 0) return '';
                    return `
                        <div class="mb-4">
                            <p class="mb-2 text-[10px] font-semibold uppercase tracking-[0.32em] text-ink-soft dark:text-ink-invert-soft">Routing Path</p>
                            <div class="flex flex-wrap items-center gap-2 text-xs font-medium text-ink dark:text-ink-invert">
                                ${path.map((step, index) => `
                                    <div class="flex items-center gap-2">
                                        <span class="rounded-md bg-surface-soft px-2.5 py-1 text-[11px] font-medium text-ink dark:bg-surface-dark-soft dark:text-ink-invert">${step.provider_name}</span>
                                        ${index < path.length - 1 ? '<span class="text-ink-soft dark:text-ink-invert-soft">→</span>' : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                };

                const quoteCards = quotes.map((quote) => {
                    const minAmount = formatAmount(quote.min_amount) || '0';
                    const maxAmount = formatAmount(quote.max_amount) || '0';
                    const feeForMin = formatAmount(quote.fee_amount_for_min) || '0';
                    const feeForMax = formatAmount(quote.fee_amount_for_max) || '0';
                    const percentageFee = formatAmount(quote.total_percentage_fee) || '0';
                    const fixedFeeUsd = formatAmount(quote.total_fixed_fee_in_usd) || '0';
                    const timeDisplay = formatTime(quote.avg_completion_milliseconds);

                    // Calculate USD conversion rate from the API response
                    let usdRate = 0;
                    let feeForMinUsd = '';
                    let feeForMaxUsd = '';

                    // Try to get USD rate from max_amount_in_usd / max_amount, or min_amount_in_usd / min_amount
                    if (quote.max_amount_in_usd && quote.max_amount && quote.max_amount > 0) {
                        usdRate = quote.max_amount_in_usd / quote.max_amount;
                    } else if (quote.min_amount_in_usd && quote.min_amount && quote.min_amount > 0) {
                        usdRate = quote.min_amount_in_usd / quote.min_amount;
                    }

                    // Calculate USD values for fees if we have a rate
                    if (usdRate > 0) {
                        feeForMinUsd = formatAmount(parseFloat(feeForMin) * usdRate);
                        feeForMaxUsd = formatAmount(parseFloat(feeForMax) * usdRate);
                    }

                    const usdRange = (quote.min_amount_in_usd && quote.max_amount_in_usd)
                        ? `<p class="mt-1 text-[11px] text-ink-soft dark:text-ink-invert-soft">$${formatAmount(quote.min_amount_in_usd)} - $${formatAmount(quote.max_amount_in_usd)}</p>`
                        : '';

                    const hasPercentageFee = parseFloat(percentageFee) > 0;
                    const hasFixedFee = parseFloat(fixedFeeUsd) > 0;
                    const feeStructureParts = [];
                    if (hasPercentageFee) feeStructureParts.push(`${percentageFee}%`);
                    if (hasFixedFee) feeStructureParts.push(`$${fixedFeeUsd}`);
                    const feeStructureText = feeStructureParts.length ? feeStructureParts.join(' + ') : 'No fees';

                    return `
                        <div class="rounded-2xl border border-slate-200/70 bg-white/90 p-4 shadow-sm dark:border-white/10 dark:bg-surface-dark/60">
                            ${buildRoutePath(quote.path)}
                            <div class="grid gap-4 text-sm text-ink dark:text-ink-invert sm:grid-cols-2">
                                <div>
                                    <p class="text-[10px] font-semibold uppercase tracking-[0.32em] text-ink-soft dark:text-ink-invert-soft">Amount Range</p>
                                    <p class="text-base font-semibold text-ink dark:text-ink-invert">${minAmount} - ${maxAmount} ${state.sourceToken}</p>
                                    ${usdRange}
                                </div>
                                <div>
                                    <p class="text-[10px] font-semibold uppercase tracking-[0.32em] text-ink-soft dark:text-ink-invert-soft">Processing Time</p>
                                    <p class="text-base font-semibold text-ink dark:text-ink-invert">${timeDisplay}</p>
                                </div>
                            </div>
                            <div class="mt-4 grid gap-3 text-xs sm:grid-cols-3">
                                ${buildFeeCard('MIN FEE', `${feeForMin} ${state.sourceToken}`, feeForMinUsd)}
                                ${buildFeeCard('MAX FEE', `${feeForMax} ${state.sourceToken}`, feeForMaxUsd)}
                                ${buildFeeCard('FEE STRUCTURE', feeStructureText, '')}
                            </div>
                        </div>
                    `;
                }).join('');

                const quoteHTML = `
                    <div class="rounded-2xl border border-slate-200/70 bg-white/90 p-6 shadow-sm dark:border-white/10 dark:bg-surface-dark/80">
                        ${quotes.length > 1 ? `
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-ink dark:text-ink-invert">Available Routes</h4>
                            </div>
                        ` : ''}
                        <div class="flex flex-col gap-4">
                            ${quoteCards}
                        </div>
                    </div>
                `;

                quoteContainer.innerHTML = quoteHTML;
                quoteContainer.classList.remove('hidden');

                // Show and populate swap request fields
                document.getElementById('swapField-sourceNetwork').textContent = state.sourceNetwork;
                document.getElementById('swapField-sourceToken').textContent = state.sourceToken;
                document.getElementById('swapField-destNetwork').textContent = config.destinationNetwork;
                const destToken = state.tokenMode === 'single' ? config.destinationToken : state.destinationTokenMultiple;
                document.getElementById('swapField-destToken').textContent = destToken;
                document.getElementById('swapField-destAddress').textContent = config.walletAddress;
                document.getElementById('swapField-refuel').textContent = 'false';
                document.getElementById('swapField-useDepositAddress').textContent = 'true';
                document.getElementById('swapRequestFields').classList.remove('hidden');

                // Unlock and enable step 4
                document.getElementById('step4').classList.remove('locked');
                document.getElementById('createSwapBtn').disabled = false;
                unlockNavItem('step4');

            } catch (error) {
                showResult(resultBox, `Error: ${error.message || 'Failed to get quote'}`, { variant: 'error' });
            }
        }

        async function createSwap() {
            const swapData = {
                source_network: state.sourceNetwork,
                source_token: state.sourceToken,
                destination_network: config.destinationNetwork,
                destination_token: state.tokenMode === 'single' ? config.destinationToken : state.destinationTokenMultiple,
                destination_address: config.walletAddress,
                // Note: amount parameter is not required in the new API
                refuel: false,
                use_deposit_address: true
            };

            const endpoint = '/swaps';
            const fullUrl = `${API_BASE}${endpoint}`;

            const resultBox = document.getElementById('step4-result');
            showResult(resultBox, 'Creating swap...');

            try {
                const data = await apiCall(endpoint, 'POST', swapData, 4);

                state.swapId = data.data.swap.id;

                if (!state.swapId) {
                    throw new Error('No swap ID returned from API');
                }

                showResult(resultBox, `Swap created: <span class="${DYNAMIC_BADGE_CLASSES}">${state.swapId}</span>`, { variant: 'success', html: true });

                // Display deposit info
                // Note: deposit_actions might be empty, in which case the deposit address
                // can be found in the swap transactions once they're created
                const depositActions = data.data.deposit_actions || [];
                let depositAddress = 'N/A';

                if (depositActions.length > 0 && depositActions[0].to_address) {
                    depositAddress = depositActions[0].to_address;
                } else {
                    // If no deposit_actions, the API might return the address elsewhere
                    // or it will be available when tracking the swap status
                    depositAddress = 'Pending - Check status for deposit address';
                }

                // Format network name for display
                const networkDisplayName = state.sourceNetwork
                    .replace(/_MAINNET/g, '')
                    .replace(/_SEPOLIA/g, ' Sepolia')
                    .replace(/_/g, ' ');

                document.getElementById('depositAddress').textContent = depositAddress;
                document.getElementById('depositTokenSymbol').textContent = state.sourceToken;
                document.getElementById('depositNetworkName').textContent = networkDisplayName;
                document.getElementById('depositInfo').classList.remove('hidden');

                // Unlock and enable step 5
                document.getElementById('step5').classList.remove('locked');
                document.getElementById('trackBtn').disabled = false;
                unlockNavItem('step5');

            } catch (error) {
                const errorMessage = error.message || 'Failed to create swap';
                showResult(resultBox, `Error: ${errorMessage}`, { variant: 'error' });
            }
        }

        function copyAddress(event) {
            const address = document.getElementById('depositAddress').textContent;
            copyToClipboard(address, event);
        }

        async function trackSwap() {
            const resultBox = document.getElementById('step5-result');
            const trackBtn = document.getElementById('trackBtn');

            if (!state.swapId) {
                showResult(resultBox, 'Error: No swap ID found. Please create a swap first in Step 4.', { variant: 'error' });
                return;
            }

            // If currently tracking, stop it
            if (state.trackingInterval) {
                clearInterval(state.trackingInterval);
                state.trackingInterval = null;

                // Clear any countdown interval if exists
                if (state.countdownInterval) {
                    clearInterval(state.countdownInterval);
                    state.countdownInterval = null;
                }

                // Reset button to initial state
                trackBtn.textContent = 'Check Status';
                trackBtn.style.background = '';
                trackBtn.style.color = '';

                // Hide swap route when tracking stops
                document.getElementById('swapRoute').classList.add('hidden');

                showResult(resultBox, 'Tracking stopped');
                return;
            }

            // Ensure no stale intervals exist
            if (state.trackingInterval) {
                clearInterval(state.trackingInterval);
                state.trackingInterval = null;
            }

            const endpoint = `/swaps/${state.swapId}`;
            const fullUrl = `${API_BASE}${endpoint}`;

            // Show status guide and swap route when tracking starts
            document.getElementById('statusGuide').classList.remove('hidden');
            document.getElementById('swapTransactions').classList.remove('hidden');

            showResult(resultBox, 'Tracking swap status (updates every 5s)...');

            // Update button to show tracking is active
            trackBtn.textContent = 'Stop Tracking';
            trackBtn.style.background = 'var(--error-border)';
            trackBtn.style.color = 'var(--bg-primary)';

            // Countdown timer state
            let secondsUntilRefresh = 5;
            state.countdownInterval = null;

            // Function to update countdown display
            const updateCountdown = () => {
                if (secondsUntilRefresh > 0) {
                    trackBtn.textContent = `Refreshing in ${secondsUntilRefresh}s...`;
                    secondsUntilRefresh--;
                } else {
                    // Clear countdown when refreshing
                    if (state.countdownInterval) {
                        clearInterval(state.countdownInterval);
                        state.countdownInterval = null;
                    }
                }
            };

            // Poll every 5 seconds
            const poll = async () => {
                try {
                    // Update button to show loading
                    trackBtn.innerHTML = `
                        <span class="inline-flex items-center gap-2 text-sm font-medium">
                            <span class="h-3 w-3 animate-spin rounded-full border-2 border-brand/70 border-t-transparent"></span>
                            Loading...
                        </span>
                    `;

                    const data = await apiCall(endpoint, 'GET', null, 5);

                    // The swap data might be at data.data or data.data.swap
                    const swap = data.data.swap || data.data;

                    if (!swap || !swap.status) {
                        throw new Error('Invalid swap data received from API');
                    }

                    const status = swap.status.toLowerCase();

                    // Display swap route information
                    const sourceNet = swap.source_network?.display_name || swap.source_network?.name || 'Unknown';
                    const sourceToken = swap.source_token?.symbol || 'Unknown';
                    const destNet = swap.destination_network?.display_name || swap.destination_network?.name || 'Unknown';
                    const destToken = swap.destination_token?.symbol || 'Unknown';

                    // Display swap route outside of result box
                    const swapRouteElement = document.getElementById('swapRoute');
                    swapRouteElement.innerHTML = `
                        <span class="${DYNAMIC_BADGE_CLASSES}">${sourceNet} ${sourceToken}</span>
                        <span class="text-base font-semibold text-ink-soft dark:text-ink-invert-soft">→</span>
                        <span class="${DYNAMIC_BADGE_CLASSES}">${destNet} ${destToken}</span>
                    `;
                    swapRouteElement.classList.remove('hidden');

                    // Display only status in result box
                    showResult(resultBox, `Status: <span class="${DYNAMIC_BADGE_CLASSES}">${swap.status}</span>`, { variant: 'success', html: true });

                    // Reset countdown and start timer
                    secondsUntilRefresh = 5;
                    if (state.countdownInterval) clearInterval(state.countdownInterval);
                    state.countdownInterval = setInterval(updateCountdown, 1000);
                    trackBtn.textContent = `Refreshing in ${secondsUntilRefresh}s...`;
                    trackBtn.style.background = 'var(--error-border)';
                    trackBtn.style.color = 'var(--bg-primary)';

                    // Display inputs (deposit transactions)
                    const inputsContainer = document.getElementById('swapInputs');
                    const inputs = swap.transactions?.filter(tx => tx.type === 'input') || [];
                    if (inputs.length > 0) {
                        inputsContainer.innerHTML = `
                            <div class="transaction-container">
                                <div class="transaction-title">Deposit</div>
                                ${inputs.map((tx, index) => {
                                    const explorerUrl = tx.network?.transaction_explorer_template?.replace('{0}', tx.transaction_hash || '');
                                    const networkName = tx.network?.display_name || tx.network?.name || 'Unknown';
                                    const networkLogo = tx.network?.logo || '';
                                    const tokenSymbol = tx.token?.symbol || 'N/A';
                                    const shortHash = tx.transaction_hash ?
                                        `${tx.transaction_hash.substring(0, 8)}...${tx.transaction_hash.substring(tx.transaction_hash.length - 6)}` : '';
                                    const timestamp = tx.timestamp ? new Date(tx.timestamp).toLocaleTimeString() : null;
                                    const statusClass = tx.status === 'completed' ? 'output' : 'input';

                                    return `
                                    <div class="transaction-card">
                                        ${networkLogo ? `<img src="${networkLogo}" alt="${networkName}" class="transaction-logo">` : ''}
                                        <div class="transaction-main">
                                            <div class="transaction-header">
                                                <span class="transaction-type ${statusClass}">${tx.status || 'pending'}</span>
                                                ${timestamp ? `<span style="font-size: 10px; color: var(--text-secondary);">${timestamp}</span>` : ''}
                                            </div>
                                            <div style="display: flex; align-items: baseline; gap: 6px;">
                                                <span style="font-size: 14px; font-weight: 600; color: var(--text-primary);">
                                                    ${formatAmount(tx.amount)} ${tokenSymbol}
                                                </span>
                                                <span style="font-size: 11px; color: var(--text-secondary);">on ${networkName}</span>
                                            </div>
                                            ${tx.transaction_hash ? `
                                            <div style="font-size: 11px; color: var(--text-secondary);">
                                                ${explorerUrl ?
                                                    `<a href="${explorerUrl}" target="_blank" class="transaction-hash-link" style="color: var(--accent-primary);">${shortHash}</a>` :
                                                    `<span>${shortHash}</span>`}
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        `;
                    } else {
                        inputsContainer.innerHTML = '<div style="font-size: 12px; color: var(--text-secondary); padding: 16px; text-align: center;">Awaiting deposit transaction...</div>';
                    }

                    // Display outputs (withdrawal transactions)
                    const outputsContainer = document.getElementById('swapOutputs');
                    const outputs = swap.transactions?.filter(tx => tx.type === 'output') || [];
                    if (outputs.length > 0) {
                        outputsContainer.innerHTML = `
                            <div class="transaction-container">
                                <div class="transaction-title">Withdrawal</div>
                                ${outputs.map((tx, index) => {
                                    const explorerUrl = tx.network?.transaction_explorer_template?.replace('{0}', tx.transaction_hash || '');
                                    const networkName = tx.network?.display_name || tx.network?.name || 'Unknown';
                                    const networkLogo = tx.network?.logo || '';
                                    const tokenSymbol = tx.token?.symbol || 'N/A';
                                    const shortHash = tx.transaction_hash ?
                                        `${tx.transaction_hash.substring(0, 8)}...${tx.transaction_hash.substring(tx.transaction_hash.length - 6)}` : '';
                                    const timestamp = tx.timestamp ? new Date(tx.timestamp).toLocaleTimeString() : null;
                                    const statusClass = tx.status === 'completed' ? 'output' : 'input';

                                    return `
                                    <div class="transaction-card">
                                        ${networkLogo ? `<img src="${networkLogo}" alt="${networkName}" class="transaction-logo">` : ''}
                                        <div class="transaction-main">
                                            <div class="transaction-header">
                                                <span class="transaction-type ${statusClass}">${tx.status || 'pending'}</span>
                                                ${timestamp ? `<span style="font-size: 10px; color: var(--text-secondary);">${timestamp}</span>` : ''}
                                            </div>
                                            <div style="display: flex; align-items: baseline; gap: 6px;">
                                                <span style="font-size: 14px; font-weight: 600; color: var(--text-primary);">
                                                    ${formatAmount(tx.amount)} ${tokenSymbol}
                                                </span>
                                                <span style="font-size: 11px; color: var(--text-secondary);">on ${networkName}</span>
                                            </div>
                                            ${tx.transaction_hash ? `
                                            <div style="font-size: 11px; color: var(--text-secondary);">
                                                ${explorerUrl ?
                                                    `<a href="${explorerUrl}" target="_blank" class="transaction-hash-link" style="color: var(--accent-primary);">${shortHash}</a>` :
                                                    `<span>${shortHash}</span>`}
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        `;
                    } else {
                        outputsContainer.innerHTML = '<div style="font-size: 12px; color: var(--text-secondary); padding: 16px; text-align: center;">Processing withdrawal...</div>';
                    }

                    // Handle swap completion or failure
                    if (status === 'completed') {
                        clearInterval(state.trackingInterval);
                        state.trackingInterval = null;
                        if (state.countdownInterval) clearInterval(state.countdownInterval);
                        trackBtn.textContent = 'Check Status';
                        trackBtn.style.background = '';
                        trackBtn.style.color = '';
                        showResult(resultBox, `Status: <span class="${DYNAMIC_BADGE_CLASSES}">Completed</span>`, { variant: 'success', html: true });
                    } else if (status === 'failed' || status === 'cancelled') {
                        showResult(resultBox, `Status: <span class="${DYNAMIC_BADGE_CLASSES}">${swap.status}</span>`, { variant: 'error', html: true });
                        clearInterval(state.trackingInterval);
                        state.trackingInterval = null;
                        if (state.countdownInterval) clearInterval(state.countdownInterval);
                        trackBtn.textContent = 'Check Status';
                        trackBtn.style.background = '';
                        trackBtn.style.color = '';
                    }

                } catch (error) {
                    // Continue countdown on error but show error message
                    secondsUntilRefresh = 5;
                    if (state.countdownInterval) clearInterval(state.countdownInterval);
                    state.countdownInterval = setInterval(updateCountdown, 1000);
                    trackBtn.textContent = `Refreshing in ${secondsUntilRefresh}s...`;
                    trackBtn.style.background = 'var(--error-border)';
                    trackBtn.style.color = 'var(--bg-primary)';

                    showResult(resultBox, `Error: ${error.message || 'Failed to track swap'}`, { variant: 'error' });
                }
            };

            poll();
            state.trackingInterval = setInterval(poll, POLL_INTERVAL_MS);
        }

        // Cleanup function to prevent memory leaks
        function cleanupIntervals() {
            if (state.trackingInterval) {
                clearInterval(state.trackingInterval);
                state.trackingInterval = null;
            }
            if (state.countdownInterval) {
                clearInterval(state.countdownInterval);
                state.countdownInterval = null;
            }
        }

        // === MOBILE MENU ===
        function initMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
            const mobileMenuClose = document.getElementById('mobileMenuClose');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link:not(.locked)');

            if (!mobileMenuBtn || !mobileMenuOverlay) return;

            const bars = mobileMenuBtn.querySelectorAll('span');

            const setMenuState = (isOpen) => {
                mobileMenuOverlay.classList.toggle('active', isOpen);
                mobileMenuBtn.classList.toggle('active', isOpen);
                document.body.style.overflow = isOpen ? 'hidden' : '';

                if (bars.length === 3) {
                    bars[0].classList.toggle('translate-y-1.5', isOpen);
                    bars[0].classList.toggle('rotate-45', isOpen);
                    bars[1].classList.toggle('opacity-0', isOpen);
                    bars[2].classList.toggle('-translate-y-1.5', isOpen);
                    bars[2].classList.toggle('-rotate-45', isOpen);
                }
            };

            // Toggle mobile menu
            mobileMenuBtn.addEventListener('click', function() {
                const shouldOpen = !mobileMenuOverlay.classList.contains('active');
                setMenuState(shouldOpen);
            });

            // Close mobile menu
            if (mobileMenuClose) {
                mobileMenuClose.addEventListener('click', function() {
                    setMenuState(false);
                });
            }

            // Close menu when clicking outside
            mobileMenuOverlay.addEventListener('click', function(e) {
                if (e.target === mobileMenuOverlay) {
                    setMenuState(false);
                }
            });

            // Close menu when clicking on a nav link
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', function() {
                    setMenuState(false);
                });
            });

            // Sync navigation states between desktop and mobile
            const syncNavigation = () => {
                // Sync active states
                const activeDesktopLink = document.querySelector('.nav-link.active');
                if (activeDesktopLink) {
                    const href = activeDesktopLink.getAttribute('href');
                    const activeMobileLink = document.querySelector(`.mobile-nav-link[href="${href}"]`);
                    if (activeMobileLink) {
                        document.querySelectorAll('.mobile-nav-link').forEach(link => {
                            link.classList.remove('active');
                        });
                        activeMobileLink.classList.add('active');
                    }
                }

                // Sync locked states
                document.querySelectorAll('.nav-link').forEach(desktopLink => {
                    const href = desktopLink.getAttribute('href');
                    const mobileLink = document.querySelector(`.mobile-nav-link[href="${href}"]`);
                    if (mobileLink) {
                        if (desktopLink.classList.contains('locked')) {
                            mobileLink.classList.add('locked');
                        } else {
                            mobileLink.classList.remove('locked');
                        }
                    }
                });

                // Sync multiple tokens nav visibility
                const multipleTokensNavDesktop = document.querySelector('.nav-sidebar .multiple-tokens-nav');
                const multipleTokensNavMobile = document.querySelector('.mobile-menu .multiple-tokens-nav');
                if (multipleTokensNavDesktop && multipleTokensNavMobile) {
                    multipleTokensNavMobile.style.display = multipleTokensNavDesktop.style.display;
                }

                // Sync step labels for mobile
                const step3Label = document.getElementById('nav-step3-label');
                const mobileStep3Label = document.getElementById('mobile-nav-step3-label');
                if (step3Label && mobileStep3Label) {
                    mobileStep3Label.textContent = step3Label.textContent;
                }

                const step4Label = document.getElementById('nav-step4-label');
                const mobileStep4Label = document.getElementById('mobile-nav-step4-label');
                if (step4Label && mobileStep4Label) {
                    mobileStep4Label.textContent = step4Label.textContent;
                }

                const step5Label = document.getElementById('nav-step5-label');
                const mobileStep5Label = document.getElementById('mobile-nav-step5-label');
                if (step5Label && mobileStep5Label) {
                    mobileStep5Label.textContent = step5Label.textContent;
                }
            };

            // Watch for navigation changes
            const observer = new MutationObserver(syncNavigation);
            const navSidebar = document.querySelector('.nav-sidebar');
            if (navSidebar) {
                observer.observe(navSidebar, {
                    attributes: true,
                    childList: true,
                    subtree: true,
                    attributeFilter: ['class', 'style']
                });
            }

            // Initial sync
            syncNavigation();
        }

        // Initialize mobile menu when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initMobileMenu);
        } else {
            initMobileMenu();
        }

        // Clean up on page unload
        window.addEventListener('beforeunload', cleanupIntervals);
        window.addEventListener('pagehide', cleanupIntervals);
    </script>
</body>
</html>
